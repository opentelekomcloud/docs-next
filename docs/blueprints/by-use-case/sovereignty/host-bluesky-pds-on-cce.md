---
id: host-bluesky-pds-on-cce
title: Host a Bluesky Personal Data Server on CCE
tags: [social,bluesky,bluesky-pds, twitter, cce]
---

# Host a Bluesky Personal Data Server on CCE

The [Bluesky Personal Data Server (PDS)](https://github.com/bluesky-social/pds) provides solution for users looking to take control of their social media data while participating in the decentralized AT Protocol network. This blueprint outlines how to host and manage a Bluesky PDS using Helm charts on CCE, giving you complete ownership and control over your social media presence.

The [AT Protocol](https://atproto.com/) is architected with a federated network design, featuring Personal Data Servers (PDS), Relays, and App Views as core components. A PDS acts as your agent in the network, hosting your data, managing your identity, and handling authentication while maintaining full interoperability with the broader Bluesky ecosystem.

:::info See also
For a more detailed overview of the architecture, explore the [AT Protocol documentation](https://atproto.com/guides/overview) and [Bluesky's federation architecture](https://docs.bsky.app/docs/advanced-guides/federation-architecture).
:::

## Benefits of Self-Hosting Bluesky PDS

### Data Ownership and Control

Self-hosting a PDS ensures complete ownership of your social media data. Unlike traditional social media platforms where your content is stored on their servers, your PDS gives you **full control** over your posts, identities, likes, follows, and other social interactions. This fundamental shift means no single social media company can delete your account or restrict access to your data.

### Enhanced Privacy and Portability

With a self-hosted PDS, you maintain strict control over data privacy and can easily migrate between different platforms within the AT Protocol network. Your identity and content remain portable, allowing seamless transitions between hosting providers without losing your social connections or historical data.

## Prerequisites

Before implementing Bluesky PDS on CCE, ensure you have:

1. **CCE Cluster**: Kubernetes v1.16 or higher is recommended.
2. **Helm**: Installed and configured for package management.
3. **cert-manager**: Required for SSL certificate management.
4. **kubectl**: Command-line access to your Kubernetes cluster.
5. **Domain Name**: A valid domain name you control for DNS configuration. 
6. **SMTP Service**: Email relay service (e.g., [Resend](https://resend.com/), [SendGrid](https://sendgrid.com/)) for account verification. 

//TODO: Show how he can configure it with Resend (note that is not meant for production)

## Deploying the Bluesky PDS

### Creating Namespace

Create a namespace for Bluesky PDS, if you don't have one already:

```bash
kubectl create namespace bluesky-pds
```

### Creating Kubernetes Secrets

The PDS requires several secrets for secure operation. Change value of **emailSmtpUrl** with your SMTP service URL and create the secret with autogenerated random credentials by running the following command:

```bash
kubectl create secret generic pds -n bluesky-pds \
  --from-literal="adminPassword=$(openssl rand --hex 16)" \
  --from-literal="jwtSecret=$(openssl rand --hex 16)" \
  --from-literal="plcRotationKey=$(
    openssl ecparam --name secp256k1 --genkey --noout --outform DER \
      | tail --bytes=+8 \
      | head --bytes=32 \
      | xxd --plain --cols 32
  )" \
  --from-literal="emailSmtpUrl=smtps://user:password@smtp.example.com:465/" 

```

### Adding the Helm Repository
Add the following Helm repository which contains an *unofficial* Bluesky PDS chart:

:::warning Disclaimer
This Helm Chart is a community contribution. Bluesky has not released an official chart as of this writing. Use it at your own risk, and as with every open source code snippet or product be sure to review its internals and license thoroughly before deploying it in your environment.

Using this chart for the Blueprint does not imply endorsement by T-Systems International GmbH or Open Telekom Cloud. We are not involved in its development or maintenance.
:::

```bash
helm repo add nerkho https://charts.nerkho.ch
helm repo update
```

### Configuring the Helm Values

Create a `values.yaml` file with your PDS configuration:

:::note
Replace the `example.com` with your own domain.
:::


```yaml title="values.yaml"
pds:
  config:
    hostname: "pds.example.com"
    secrets:
      existingSecret : "pds"
    pdsEmailFromAddress: "pds@example.com"
  dataStorage:
    size: 10Gi
    storageClass: csi-disk
ingress:
  enabled: true
  className: "nginx"
  annotations:
    kubernetes.io/tls-acme: "true"
    cert-manager.io/cluster-issuer: opentelekomcloud-letsencrypt
  hosts:
    - host: pds.example.com
      paths:
        - path: /
          pathType: Prefix
    - host: "*.pds.example.com"
      paths:
        - path: /
          pathType: Prefix
  tls:
   - secretName: bluesky-pds-tls
     hosts:
       - pds.example.com
       - "*.pds.example.com"
```

:::important

* Notice that two hosts are provided under `ingress`. One for the PDS reachability and a wildcard for each user. This is required as on the AT Protocol, each user has its own subdomain. Alternatively, you could just list each subdomain for each user of your PDS manually instead of using a wildcard. **The wildcard record is required when allowing users to create new accounts on your PDS**.

* The provided annotations for `ingress` are required to obtain a TLS certificate for your PDS domain (e.g., `pds.example.com` and `*.pds.example.com`).

  ```yaml
  kubernetes.io/tls-acme: "true"
  cert-manager.io/cluster-issuer: opentelekomcloud-letsencrypt
  ```

  Follow the instructions from Best Practice: [Issue an ACME Certificate with DNS01 Solver in CCE](/docs/best-practices/containers/cloud-container-engine/issue-an-acme-certificate-with-dns01-solver-in-cce.md), to prepare your cluster properly.

:::

### Deploying the PDS

Install the Bluesky PDS using Helm:

```bash
helm install bluesky-pds nerkho/bluesky-pds \
  --namespace bluesky-pds \
  --create-namespace \
  -f values.yaml
```

Verify the deployment:

```bash
kubectl get pods -n bluesky-pds
kubectl get ingress -n bluesky-pds
```

Check if your PDS is accessible:

```bash
curl https://pds.example.com/
# Expected output: "This is an AT Protocol Personal Data Server (PDS)"

curl https://pds.example.com/xrpc/_health
# Expected output: {"version":"0.4.x"}
```

//TODO: What about configuring DNS and _atproto.pds.example.com? 
//TODO: What about creating a request for a crawl? 

## Creating User Accounts

### Generate Invite Code

Create an invite code for new user registration:

```bash
export PDS_ADMIN_PASSWORD=$(kubectl get secrets pds -n bluesky-pds  -o jsonpath='{.data.adminPassword}' | base64 --decode)
export PDS_HOSTNAME=pds.example.com

curl --silent --show-error --request POST \
  --header "Content-Type: application/json" \
  --user "admin:${PDS_ADMIN_PASSWORD}" \
  --data '{"useCount": 1}' \
  "https://${PDS_HOSTNAME}/xrpc/com.atproto.server.createInviteCode" | \
  jq --raw-output '.code'
```

### Create User Account

Create a `user-data.json` file with the following content. Replace the placeholders and provide invite code from the previous step:

```json title="user-data.json"
{
  "email": "<YOUR_EMAIL>",
  "handle": "<USERNAME>.pds.example.com",
  "password": "<PASSWORD>",
  "inviteCode": "<GENEATED_INVITE_CODE>"
}
```

Create the account by running the following command:

```bash
curl --silent --show-error --request POST \
  --header "Content-Type: application/json" \
  -d @user-data.json \
  "https://${PDS_HOSTNAME}/xrpc/com.atproto.server.createAccount" | jq
```
When successful you should get a JSON response structured as follows:

```json
{
  "handle": "your-handle.pds.example.com",
  "did": "did:plc:<unique-identifier>",
  "didDoc": {
    "@context": [
      "https://www.w3.org/ns/did/v1",
      "https://w3id.org/security/multikey/v1",
      "https://w3id.org/security/suites/secp256k1-2019/v1"
    ],
    "id": "did:plc:<unique-identifier>",
    "alsoKnownAs": [
      "at://your-handle.pds.example.com"
    ],
    "verificationMethod": [
      {
        "id": "did:plc:<unique-identifier>#atproto",
        "type": "Multikey",
        "controller": "did:plc:<unique-identifier>",
        "publicKeyMultibase": "<public-key-string>"
      }
    ],
    "service": [
      {
        "id": "#atproto_pds",
        "type": "AtprotoPersonalDataServer",
        "serviceEndpoint": "https://pds.example.com"
      }
    ]
  },
  "accessJwt": "<access-token>",
  "refreshJwt": "<refresh-token>"
}

```

//TODO: Its not clear where this commands should be executed?
//TODO: Show alternatively using pdsadmin 


## Connecting to Bluesky

After creating an account, you can log into Bluesky:

1. Visit [bsky.app](https://bsky.app) 
2. Click **Sign in** then click on **Hosting provider** and select **Custom** tab. Under **Server address** enter your PDS URL (e.g., `https://pds.example.com`) and click **Done**.
    ![image](/img/docs/blueprints/by-use-case/sovereignty/pds/login.png)
3. Log in with your created credentials
4. Happy discovering Bluesky!

    ![image](/img/docs/blueprints/by-use-case/sovereignty/pds/welcome.png)



## Troubleshooting Common Issues

### Handle Validation Issues

If you encounter "invalid handle" warnings:

1. Use the [Bluesky Handle Debug Page](https://bsky.social/xrpc/com.atproto.identity.resolveHandle?handle=<YOUR_HANDLE>) to check if it's registered 
2. Ensure DNS records are properly configured
3. Check that the handle is not already taken in your PDS


