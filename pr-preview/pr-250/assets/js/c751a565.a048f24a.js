"use strict";(self.webpackChunkdocs_next=self.webpackChunkdocs_next||[]).push([[18346],{59423:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>u,frontMatter:()=>c,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"best-practices/networking/nat-gateway/using-a-public-nat-gateway-and-vpc-peering-to-enable-communications-between-vpcs-and-the-internet","title":"Using a Public NAT Gateway and VPC Peering to Enable Communications Between VPCs and the Internet","description":"Two VPCs, VPC A and VPC B are in the same region. A public NAT gateway is configured for subnet A in VPC A and you can add SNAT and DNAT rules for Internet connectivity. Subnet B connects to subnet A through a VPC peering connection and uses the public NAT gateway of subnet A to communicate with the Internet.","source":"@site/docs/best-practices/networking/nat-gateway/using-a-public-nat-gateway-and-vpc-peering-to-enable-communications-between-vpcs-and-the-internet.md","sourceDirName":"best-practices/networking/nat-gateway","slug":"/best-practices/networking/nat-gateway/using-a-public-nat-gateway-and-vpc-peering-to-enable-communications-between-vpcs-and-the-internet","permalink":"/docs-next/pr-preview/pr-250/docs/best-practices/networking/nat-gateway/using-a-public-nat-gateway-and-vpc-peering-to-enable-communications-between-vpcs-and-the-internet","draft":false,"unlisted":false,"editUrl":"https://github.com/opentelekomcloud/docs-next/tree/main/docs/best-practices/networking/nat-gateway/using-a-public-nat-gateway-and-vpc-peering-to-enable-communications-between-vpcs-and-the-internet.md","tags":[{"inline":true,"label":"nat-gateway","permalink":"/docs-next/pr-preview/pr-250/docs/tags/nat-gateway"},{"inline":true,"label":"vpc-peering","permalink":"/docs-next/pr-preview/pr-250/docs/tags/vpc-peering"}],"version":"current","frontMatter":{"id":"using-a-public-nat-gateway-and-vpc-peering-to-enable-communications-between-vpcs-and-the-internet","title":"Using a Public NAT Gateway and VPC Peering to Enable Communications Between VPCs and the Internet","tags":["nat-gateway","vpc-peering"]},"sidebar":"bestPracticesSidebar","previous":{"title":"Routing Traffic to Backend Servers in Different VPCs from the Load Balancer","permalink":"/docs-next/pr-preview/pr-250/docs/best-practices/networking/elastic-load-balancing/routing-traffic-to-backend-servers-in-different-vpcs-from-the-load-balancer"},"next":{"title":"VPC and Subnet Planning Suggestions","permalink":"/docs-next/pr-preview/pr-250/docs/best-practices/networking/virtual-private-cloud/vpc-and-subnet-planning-suggestions"}}');var s=t(74848),a=t(28453);const c={id:"using-a-public-nat-gateway-and-vpc-peering-to-enable-communications-between-vpcs-and-the-internet",title:"Using a Public NAT Gateway and VPC Peering to Enable Communications Between VPCs and the Internet",tags:["nat-gateway","vpc-peering"]},o="Using a Public NAT Gateway and VPC Peering to Enable Communications Between VPCs and the Internet",r={},d=[{value:"Solution Design",id:"solution-design",level:2},{value:"Topology",id:"topology",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Deploying the Solution",id:"deploying-the-solution",level:2},{value:"Verifying Connectivity",id:"verifying-connectivity",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"using-a-public-nat-gateway-and-vpc-peering-to-enable-communications-between-vpcs-and-the-internet",children:"Using a Public NAT Gateway and VPC Peering to Enable Communications Between VPCs and the Internet"})}),"\n",(0,s.jsx)(n.p,{children:"Two VPCs, VPC A and VPC B are in the same region. A public NAT gateway is configured for subnet A in VPC A and you can add SNAT and DNAT rules for Internet connectivity. Subnet B connects to subnet A through a VPC peering connection and uses the public NAT gateway of subnet A to communicate with the Internet."}),"\n",(0,s.jsx)(n.h2,{id:"solution-design",children:"Solution Design"}),"\n",(0,s.jsxs)(n.p,{children:["The CIDR block of VPC A is ",(0,s.jsx)(n.code,{children:"192.168.0.0/16"})," and that of subnet A is ",(0,s.jsx)(n.code,{children:"192.168.1.0/24"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["The CIDR block of VPC B is ",(0,s.jsx)(n.code,{children:"192.168.0.0/16"})," and that of subnet B is ",(0,s.jsx)(n.code,{children:"192.168.2.0/24"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"topology",children:"Topology"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"A VPC peering connection is used to connect subnet A in VPC A to subnet B in VPC B."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"A public NAT gateway is created in VPC A, and subnet B can use the public NAT gateway to communicate the Internet."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://arch-assets-dev.obs.eu-de.otc.t-systems.com/static/img/docs/best-practices/networking/nat-gateway/en-us_image_0000001089261095.png",alt:"Figure 1 Network topology"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{title:"Advantages",type:"note",children:(0,s.jsx)(n.p,{children:"Only one public NAT gateway needs to be configured. Servers in the two VPCs can share the same public NAT gateway to communicate with the Internet, saving gateway resources."})}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"If VPCs connected by a VPC peering connection have overlapping CIDR blocks, the connection can only enable communications between specific (non-overlapping) subnets in the VPCs."}),"\n",(0,s.jsxs)(n.li,{children:["All subnets of the two VPCs do not overlap with each other. For details, see ",(0,s.jsx)(n.a,{href:"https://docs.otc.t-systems.com/virtual-private-cloud/umn/vpc_peering_connection/vpc_peering_connection_usage_examples.html",children:"VPC Peering Connection Usage Examples"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"deploying-the-solution",children:"Deploying the Solution"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Create VPC A, VPC B, subnet A, and subnet B."}),"\n",(0,s.jsxs)(n.p,{children:["For detailed operations, see ",(0,s.jsx)(n.a,{href:"https://docs.otc.t-systems.com/virtual-private-cloud/umn/vpc_and_subnet/vpc/creating_a_vpc.html",children:"Creating a VPC"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Create a VPC peering connection."}),"\n",(0,s.jsxs)(n.p,{children:["Create a VPC peering connection between subnet A and subnet B. For detailed operations, see ",(0,s.jsx)(n.a,{href:"https://docs.otc.t-systems.com/virtual-private-cloud/umn/vpc_peering_connection/creating_a_vpc_peering_connection_with_another_vpc_in_your_account.html",children:"Creating a VPC Peering Connection with Another VPC in Your Account"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"The local VPC is VPC A, and the peer VPC is VPC B."}),"\n",(0,s.jsxs)(n.p,{children:["Add a route in the route table of VPC B. Set ",(0,s.jsx)(n.em,{children:"Destination"})," to ",(0,s.jsx)(n.code,{children:"0.0.0.0/0"})," and ",(0,s.jsx)(n.em,{children:"Next Hop"})," to the created VPC peering connection between VPC A and VPC B."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Create a public NAT gateway."}),"\n",(0,s.jsxs)(n.p,{children:["Create a public NAT gateway with ",(0,s.jsx)(n.em,{children:"VPC"})," set to VPC A. For details about how to configure other parameters, see ",(0,s.jsx)(n.a,{href:"https://docs.otc.t-systems.com/nat-gateway/umn/managing_nat_gateways/creating_a_public_nat_gateway.html",children:"Creating a Public NAT Gateway"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Add an SNAT rule."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Select ",(0,s.jsx)(n.em,{children:"VPC"})," for ",(0,s.jsx)(n.em,{children:"Scenario"})," and subnet A for ",(0,s.jsx)(n.em,{children:"Subnet"}),". For more details, see ",(0,s.jsx)(n.a,{href:"https://docs.otc.t-systems.com/nat-gateway/umn/managing_snat_rules/adding_an_snat_rule.html",children:"Adding an SNAT Rule"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Add an SNAT rule for subnet B. Set ",(0,s.jsx)(n.em,{children:"Scenario"})," to ",(0,s.jsx)(n.em,{children:"Direct Connect/Cloud Connect"})," and enter the CIDR block of subnet B."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Add a DNAT rule."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Add a DNAT rule for subnet A. Select ",(0,s.jsx)(n.em,{children:"VPC"})," for ",(0,s.jsx)(n.em,{children:"Scenario"})," and enter an IP address of a server in subnet A for ",(0,s.jsx)(n.em,{children:"Private IP Address"}),". For more details, see ",(0,s.jsx)(n.a,{href:"https://docs.otc.t-systems.com/nat-gateway/umn/managing_dnat_rules/adding_a_dnat_rule.html",children:"Adding a DNAT Rule"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Add a DNAT rule for subnet B. Set ",(0,s.jsx)(n.em,{children:"Scenario"})," to ",(0,s.jsx)(n.em,{children:"Direct Connect/Cloud Connect"})," and enter an IP address of a server in subnet B for ",(0,s.jsx)(n.em,{children:"Private IP Address"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"verifying-connectivity",children:"Verifying Connectivity"}),"\n",(0,s.jsx)(n.p,{children:"After the configuration is complete, test the network connectivity."}),"\n",(0,s.jsx)(n.p,{children:"Log in to a server in subnet B and ping a public IP address."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://arch-assets-dev.obs.eu-de.otc.t-systems.com/static/img/docs/best-practices/networking/nat-gateway/en-us_image_0000001092787311.png",alt:"Figure 2"})}),"\n",(0,s.jsxs)(n.p,{children:["Log in to a server that can access the Internet and is not deployed in VPC A or VPC B. Use ",(0,s.jsx)(n.strong,{children:"curl"})," to check whether the server can communicate with subnet B via the EIP associated with the DNAT rule configured for subnet B."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://arch-assets-dev.obs.eu-de.otc.t-systems.com/static/img/docs/best-practices/networking/nat-gateway/en-us_image_0000001093306041.png",alt:"Figure 3"})})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>o});var i=t(96540);const s={},a=i.createContext(s);function c(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);