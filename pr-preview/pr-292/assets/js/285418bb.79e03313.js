"use strict";(self.webpackChunkdocs_next=self.webpackChunkdocs_next||[]).push([[22837],{62113:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"blueprints/by-use-case/devops/self-hosting-github-runners-on-cce","title":"Self-Hosting GitHub Runners on CCE","description":"Overview","source":"@site/docs/blueprints/by-use-case/devops/self-hosting-github-runners-on-cce.md","sourceDirName":"blueprints/by-use-case/devops","slug":"/blueprints/by-use-case/devops/self-hosting-github-runners-on-cce","permalink":"/docs-next/pr-preview/pr-292/docs/blueprints/by-use-case/devops/self-hosting-github-runners-on-cce","draft":false,"unlisted":false,"editUrl":"https://github.com/opentelekomcloud/docs-next/tree/main/docs/blueprints/by-use-case/devops/self-hosting-github-runners-on-cce.md","tags":[{"inline":true,"label":"devops","permalink":"/docs-next/pr-preview/pr-292/docs/tags/devops"},{"inline":true,"label":"ci","permalink":"/docs-next/pr-preview/pr-292/docs/tags/ci"},{"inline":true,"label":"cd","permalink":"/docs-next/pr-preview/pr-292/docs/tags/cd"},{"inline":true,"label":"ci/cd","permalink":"/docs-next/pr-preview/pr-292/docs/tags/ci-cd"},{"inline":true,"label":"github","permalink":"/docs-next/pr-preview/pr-292/docs/tags/github"},{"inline":true,"label":"github-actions","permalink":"/docs-next/pr-preview/pr-292/docs/tags/github-actions"},{"inline":true,"label":"github-runner","permalink":"/docs-next/pr-preview/pr-292/docs/tags/github-runner"},{"inline":true,"label":"cce","permalink":"/docs-next/pr-preview/pr-292/docs/tags/cce"}],"version":"current","frontMatter":{"id":"self-hosting-github-runners-on-cce","title":"Self-Hosting GitHub Runners on CCE","tags":["devops","ci","cd","ci/cd","github","github-actions","github-runner","cce"]},"sidebar":"blueprintsSidebar","previous":{"title":"Build a CI Pipeline with Jenkins, SWR and CCE","permalink":"/docs-next/pr-preview/pr-292/docs/blueprints/by-use-case/devops/ci-jenkins-swr-cce"},"next":{"title":"Networking","permalink":"/docs-next/pr-preview/pr-292/docs/blueprints/by-use-case/networking/"}}');var i=r(74848),t=r(28453);const o={id:"self-hosting-github-runners-on-cce",title:"Self-Hosting GitHub Runners on CCE",tags:["devops","ci","cd","ci/cd","github","github-actions","github-runner","cce"]},l="Self-Hosting GitHub Runners on CCE",a={},c=[{value:"Overview",id:"overview",level:2},{value:"Why Self-Host GitHub Runners on Kubernetes?",id:"why-self-host-github-runners-on-kubernetes",level:2},{value:"Cost Optimization",id:"cost-optimization",level:3},{value:"Enhanced Security and Compliance",id:"enhanced-security-and-compliance",level:3},{value:"Custom Hardware Requirements",id:"custom-hardware-requirements",level:3},{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Configure GitHub Authentication",id:"configure-github-authentication",level:2},{value:"Creating a GitHub App for ARC Authentication",id:"creating-a-github-app-for-arc-authentication",level:3},{value:"Generating a Private Key",id:"generating-a-private-key",level:3},{value:"Installing the GitHub App",id:"installing-the-github-app",level:3},{value:"Store GitHub App Credentials",id:"store-github-app-credentials",level:3},{value:"Install Actions Runner Controller",id:"install-actions-runner-controller",level:2},{value:"Configure Runner Deployments",id:"configure-runner-deployments",level:2},{value:"Runners Autoscaling",id:"runners-autoscaling",level:2},{value:"1. Register Webhook in GitHub",id:"1-register-webhook-in-github",level:3},{value:"2. Create the Webhook Secret in Kubernetes",id:"2-create-the-webhook-secret-in-kubernetes",level:3},{value:"3. Configure HorizontalRunnerAutoscaler",id:"3-configure-horizontalrunnerautoscaler",level:3},{value:"Verifying",id:"verifying",level:2},{value:"1. Check Runner Registration Status",id:"1-check-runner-registration-status",level:3},{value:"2. Create a Test Workflow",id:"2-create-a-test-workflow",level:3},{value:"3. Validate Autoscaling Behavior",id:"3-validate-autoscaling-behavior",level:3},{value:"Security Best Practices",id:"security-best-practices",level:2},{value:"Network Security",id:"network-security",level:3},{value:"Access Control",id:"access-control",level:3},{value:"Runtime Security",id:"runtime-security",level:3},{value:"Troubleshooting Common Issues",id:"troubleshooting-common-issues",level:2}];function d(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"self-hosting-github-runners-on-cce",children:"Self-Hosting GitHub Runners on CCE"})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://docs.github.com/en/actions/concepts/runners/about-self-hosted-runners",children:"Self-hosted GitHub runners"})," provide a powerful solution for organizations looking to optimize their CI/CD pipelines while maintaining control over their infrastructure. This blueprint outlines how to self-host and manage GitHub Actions runners using the ",(0,i.jsx)(n.a,{href:"https://docs.github.com/en/actions/concepts/runners/about-actions-runner-controller",children:"Actions Runner Controller (ARC)"})," on CCE."]}),"\n",(0,i.jsx)(n.h2,{id:"why-self-host-github-runners-on-kubernetes",children:"Why Self-Host GitHub Runners on Kubernetes?"}),"\n",(0,i.jsx)(n.h3,{id:"cost-optimization",children:"Cost Optimization"}),"\n",(0,i.jsx)(n.p,{children:"GitHub-hosted runners can become costly for high-volume workflows. Organizations with significant CI/CD workloads often see major savings by switching to self-hosted options."}),"\n",(0,i.jsx)(n.h3,{id:"enhanced-security-and-compliance",children:"Enhanced Security and Compliance"}),"\n",(0,i.jsx)(n.p,{children:"Self-hosted runners provide several security advantages:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Network Isolation"}),": Runners can access private databases and other internal resources during CI processes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Compliance Requirements"}),": Organizations in regulated industries can maintain strict data protection and access controls."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"custom-hardware-requirements",children:"Custom Hardware Requirements"}),"\n",(0,i.jsx)(n.p,{children:"Self-hosted runners support specialized hardware needs such as:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Dedicated GPU"})," instances for machine learning workloads"]}),"\n",(0,i.jsxs)(n.li,{children:["Specific ",(0,i.jsx)(n.strong,{children:"CPU architectures"})]}),"\n",(0,i.jsx)(n.li,{children:"Custom memory configurations"}),"\n",(0,i.jsx)(n.li,{children:"Specialized development tools and environments"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,i.jsx)(n.p,{children:"The Actions Runner Controller (ARC) is a Kubernetes operator that orchestrates and scales self-hosted runners for GitHub Actions. ARC creates several custom resource definitions (CRDs) to manage and monitor runners."}),"\n",(0,i.jsx)(n.p,{children:"For a quick overview of  the architecture, please watch this video:"}),"\n",(0,i.jsx)("iframe",{width:"100%",height:"400",src:"https://www.youtube-nocookie.com/embed/wQ0k5k6KW5Y?si=6p7_I0bHvYt0fBYk",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin",allowfullscreen:!0}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"Before implementing self-hosted GitHub runners on CCE, ensure you have:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"CCE Cluster"}),": Version 1.16 or higher is recommended."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Helm"}),": Installed and configured for package management."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"cert-manager"}),": Required for SSL certificate management."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"kubectl"}),": Command-line access to your Kubernetes cluster."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"GitHub Organization"}),": Access for configuring GitHub Apps and webhooks in your GitHub Organization."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"configure-github-authentication",children:"Configure GitHub Authentication"}),"\n",(0,i.jsx)(n.p,{children:"ARC supports multiple authentication methods. The recommended approach uses GitHub Apps for enhanced security and functionality."}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-github-app-for-arc-authentication",children:"Creating a GitHub App for ARC Authentication"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Navigate to your ",(0,i.jsx)(n.strong,{children:"GitHub organization settings"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["On the left sidebar, under ",(0,i.jsx)(n.strong,{children:"Developer settings"}),", click on ",(0,i.jsx)(n.strong,{children:"GitHub Apps"}),".\n",(0,i.jsx)(n.img,{alt:"img",src:r(46626).A+"",width:"901",height:"635"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"New GitHub app"})," to create a new app owned by your organization, and provide the following details:\n",(0,i.jsx)(n.img,{alt:"img",src:r(755).A+"",width:"972",height:"526"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"GitHub App name:"})," Choose a name for the app."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Description:"})," Briefly describe what your app does (e.g., GitHub runners on CCE)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Homepage URL:"})," Enter the ARC URL: ",(0,i.jsx)(n.code,{children:"https://github.com/actions/actions-runner-controller"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Webhook URL:"})," Should be disabled. Later, you will create a repository or organization-wide webhook for autoscaling the runners."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Permissions:"})," Select the following required permissions for the app to work properly:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Under ",(0,i.jsx)(n.strong,{children:"Repository permissions"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Administration:"})," Read and write"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Metadata:"})," Read-only"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Under ",(0,i.jsx)(n.strong,{children:"Organization permissions"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Self-hosted runners:"})," Read and write"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Where can this GitHub App be installed?:"})," Set to ",(0,i.jsx)(n.strong,{children:"Only on this account"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Create GitHub App"})," to create the app."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"img",src:r(1021).A+"",width:"790",height:"560"})}),"\n",(0,i.jsx)(n.h3,{id:"generating-a-private-key",children:"Generating a Private Key"}),"\n",(0,i.jsxs)(n.p,{children:["After creating your GitHub App, you need to generate a ",(0,i.jsx)(n.strong,{children:"private key"})," to enable secure authentication for API requests. Follow these steps:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Navigate to your ",(0,i.jsx)(n.strong,{children:"GitHub App"})," page (Go to ",(0,i.jsx)(n.strong,{children:"Organization settings"}),", then under ",(0,i.jsx)(n.strong,{children:"Developer settings"})," select ",(0,i.jsx)(n.strong,{children:"GitHub Apps"}),", and click on your newly created app)."]}),"\n",(0,i.jsxs)(n.li,{children:["Scroll down and under ",(0,i.jsx)(n.strong,{children:"Private keys"}),", click ",(0,i.jsx)(n.strong,{children:"Generate a private key"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"The private key will be generated and downloaded to your local machine."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"installing-the-github-app",children:"Installing the GitHub App"}),"\n",(0,i.jsx)(n.p,{children:"Once your app and private key are ready, install the app to your organization:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Navigate to your ",(0,i.jsx)(n.strong,{children:"GitHub App"})," page (Go to ",(0,i.jsx)(n.strong,{children:"Organization settings"}),", then under ",(0,i.jsx)(n.strong,{children:"Developer settings"})," select ",(0,i.jsx)(n.strong,{children:"GitHub Apps"}),", and click on your newly created app)."]}),"\n",(0,i.jsxs)(n.li,{children:["On the left panel, select ",(0,i.jsx)(n.strong,{children:"Install App"})," and click the ",(0,i.jsx)(n.strong,{children:"Install"})," button to install the app for all repositories or specific ones based on your needs.\n",(0,i.jsx)(n.img,{alt:"img",src:r(10216).A+"",width:"877",height:"363"})]}),"\n",(0,i.jsxs)(n.li,{children:["After confirming the installation permissions for your organization, save the app ",(0,i.jsx)(n.strong,{children:"installation ID"}),". You will use it later. You can find the app ",(0,i.jsx)(n.strong,{children:"installation ID"})," on the app installation page, which has the following URL format:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"https://HOSTNAME/organizations/ORGANIZATION/settings/installations/"}),(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"INSTALLATION_ID"})})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"store-github-app-credentials",children:"Store GitHub App Credentials"}),"\n",(0,i.jsxs)(n.admonition,{title:"Namespace",type:"info",children:[(0,i.jsx)(n.p,{children:"Create a namespace for GitHub ARC if you don't have one already:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"kubectl create namespace github-actions\n"})})]}),"\n",(0,i.jsx)(n.p,{children:"Create a Kubernetes secret with your GitHub App credentials:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"GitHub App ID:"})," The app's unique identifier. You can find it under the ",(0,i.jsx)(n.strong,{children:"General"})," section on the ",(0,i.jsx)(n.a,{href:"#installing-the-github-app",children:"GitHub App page"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Installation ID:"})," The installation ID of your organization, collected in the ",(0,i.jsx)(n.a,{href:"#installing-the-github-app",children:"previous step"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Private Key:"})," The private key of your GitHub App, downloaded in ",(0,i.jsx)(n.a,{href:"#generating-a-private-key",children:"earlier steps"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl create secret generic controller-manager \\\n  --namespace github-actions \\\n  --from-literal=github_app_id=GITHUB_APP_ID \\\n  --from-literal=github_app_installation_id=INSTALLATION_ID \\\n  --from-literal=github_app_private_key='PRIVATE_KEY'\n"})}),"\n",(0,i.jsx)(n.h2,{id:"install-actions-runner-controller",children:"Install Actions Runner Controller"}),"\n",(0,i.jsxs)(n.p,{children:["Create a ",(0,i.jsx)(n.code,{children:"values.yaml"})," file in your project directory and add the values provided below. Replace the ",(0,i.jsx)(n.code,{children:"example.com"})," domain with your own domain."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# values.yaml\nreplicaCount: 1\n\nauthSecret:\n  enabled: true\n  create: false\n  name: "controller-manager"\n\nserviceAccount:\n  create: true\n\nservice:\n  type: ClusterIP\n  port: 443\n\ncertManagerEnabled: true\n\nlogFormat: text\n\ngithubWebhookServer:\n  enabled: true\n  replicaCount: 1\n  useRunnerGroupsVisibility: false\n  logFormat: text\n  secret:\n    enabled: true\n    create: false\n    name: github-selfhosted-webhook-token\n  serviceAccount:\n    create: true\n  ingress:\n    enabled: true\n    annotations:\n      nginx.ingress.kubernetes.io/backend-protocol: "HTTP"\n      kubernetes.io/tls-acme: "true"\n      cert-manager.io/cluster-issuer: opentelekomcloud-letsencrypt\n    ingressClassName: nginx\n    tls:\n     - secretName: github-webhook-tls\n       hosts:\n         - github-webhook.example.com\n    hosts:\n      - host: github-webhook.example.com\n        paths:\n        - path: /\n          pathType: Prefix\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"important",children:(0,i.jsxs)(n.p,{children:["To enable the ",(0,i.jsx)(n.strong,{children:"Runner Autoscaling"})," feature, ",(0,i.jsx)(n.strong,{children:"githubWebhookServer"})," must be enabled."]})}),"\n",(0,i.jsxs)(n.admonition,{title:"caution",type:"warning",children:[(0,i.jsxs)(n.p,{children:["The provided annotations for ",(0,i.jsx)(n.strong,{children:"nginx"})," and ",(0,i.jsx)(n.strong,{children:"cert-manager"})," are required to obtain a TLS certificate for your webhook domain (e.g., ",(0,i.jsx)(n.strong,{children:"github-webhook.example.com"}),")."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'kubernetes.io/tls-acme: "true"\ncert-manager.io/cluster-issuer: opentelekomcloud-letsencrypt\n'})})]}),"\n",(0,i.jsxs)(n.p,{children:["After creating the ",(0,i.jsx)(n.code,{children:"values.yaml"})," file, you can install the controller with Helm by running the following command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm repo add actions-runner-controller https://actions-runner-controller.github.io/actions-runner-controller\n\nhelm upgrade --install actions-runner-controller \\\n  actions-runner-controller/actions-runner-controller \\\n  --namespace github-actions \\\n  --create-namespace \\\n  --version 0.23.7 \\\n  -f values.yaml\n"})}),"\n",(0,i.jsx)(n.p,{children:"After installing the controller, verify that it is running by checking the status of the pods:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get pods --namespace github-actions\n"})}),"\n",(0,i.jsx)(n.p,{children:"You should see output similar to:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"NAME                                                              READY   STATUS    RESTARTS   AGE\nactions-runner-controller-699df99f7-96h96                         2/2     Running   0          40s\nactions-runner-controller-github-webhook-server-8649f6764fsxq49   2/2     Running   0          40s\n"})}),"\n",(0,i.jsx)(n.h2,{id:"configure-runner-deployments",children:"Configure Runner Deployments"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.strong,{children:"RunnerDeployment"})," is a Kubernetes custom resource that automates the management of GitHub Actions runners. An important part of this configuration is defining the runner's ",(0,i.jsx)(n.strong,{children:"scope"}),", which dictates which workflows are permitted to use it. This ensures that runners are available exactly where they are needed. ",(0,i.jsx)(n.strong,{children:"Organization-level runners"})," create a centralized, shared pool of runners available to all repositories within your GitHub organization. In contrast, ",(0,i.jsx)(n.strong,{children:"Repository-level runners"})," are dedicated to a single, specific repository. This provides strong isolation and is the ideal choice for projects with specialized needs, such as unique software requirements or access to sensitive credentials, providing a secure and controlled environment for specific jobs."]}),"\n",(0,i.jsxs)(n.p,{children:["Create a YAML file to declare a ",(0,i.jsx)(n.strong,{children:"RunnerDeployment"})," for your desired scope (repository or organization)."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Organization-Level Runners"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# runner-deployment.yaml\napiVersion: actions.summerwind.dev/v1alpha1\nkind: RunnerDeployment\nmetadata:\n  name: org-runners\n  namespace: github-actions\nspec:\n  template:\n    spec:\n      labels:\n        - cce-runner\n      organization: your-organization-name\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Repository-Level Runners"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# runner-deployment.yaml\napiVersion: actions.summerwind.dev/v1alpha1\nkind: RunnerDeployment\nmetadata:\n  name: repo-runners\n  namespace: github-actions\nspec:\n  template:\n    spec:\n      labels:\n        - cce-runner\n      repository: your-org/your-repo\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["You can further customize your ",(0,i.jsx)(n.strong,{children:"RunnerDeployment"})," by specifying additional fields such as ",(0,i.jsx)(n.strong,{children:"resource requests/limits"}),", a custom ",(0,i.jsx)(n.strong,{children:"runner image"}),", or binding ",(0,i.jsx)(n.strong,{children:"Persistent Volume Claims"})," (PVCs) for data persistence. You can also provide specific environment variables for various use cases, such as allowing your runner to access internal resources or services securely."]})}),"\n",(0,i.jsx)(n.admonition,{title:"Important",type:"warning",children:(0,i.jsxs)(n.p,{children:["Make sure the ",(0,i.jsx)(n.strong,{children:"labels"})," assigned to your runner exactly match the labels specified in your workflow\u2019s ",(0,i.jsx)(n.strong,{children:"runs-on"})," field. If they do not match, your workflow jobs will not run on the intended runner!"]})}),"\n",(0,i.jsxs)(n.p,{children:["Finally, apply the ",(0,i.jsx)(n.strong,{children:"RunnerDeployment"})," using the following command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f runner-deployment.yaml\n"})}),"\n",(0,i.jsx)(n.h2,{id:"runners-autoscaling",children:"Runners Autoscaling"}),"\n",(0,i.jsx)(n.p,{children:"To ensure efficient resource utilization and responsive scaling of GitHub Actions runners, implement webhook-driven autoscaling. This enables your runners to scale up rapidly in response to workflow demand and scale down when idle, optimizing both performance and cost."}),"\n",(0,i.jsx)(n.h3,{id:"1-register-webhook-in-github",children:"1. Register Webhook in GitHub"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Go to your GitHub organization\u2019s ",(0,i.jsx)(n.strong,{children:"Settings"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Select ",(0,i.jsx)(n.strong,{children:"Webhooks"})," from the sidebar."]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Add webhook"}),".","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Payload URL:"})," Enter the endpoint that will receive webhook events (which you provided ",(0,i.jsx)(n.a,{href:"#install-actions-runner-controller",children:"earlier"}),", e.g., ",(0,i.jsx)(n.code,{children:"https://github-webhook.example.com"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Content type:"})," Choose ",(0,i.jsx)(n.code,{children:"application/json"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Secret:"})," Set a strong secret token (you\u2019ll use this in your Kubernetes secret)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Events to send:"})," Select ",(0,i.jsx)(n.strong,{children:"Let me select individual events"})," and check:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"workflow_job"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"workflow_run"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Add webhook"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"img",src:r(27666).A+"",width:"1291",height:"917"})}),"\n",(0,i.jsx)(n.h3,{id:"2-create-the-webhook-secret-in-kubernetes",children:"2. Create the Webhook Secret in Kubernetes"}),"\n",(0,i.jsx)(n.p,{children:"Store the webhook secret as a Kubernetes secret to be used by your webhook receiver:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl create secret generic github-webhook-token \\\n  --namespace github-actions \\\n  --from-literal=GITHUB_WEBHOOK_SECRET_TOKEN=WEBHOOK_SECRET\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Replace ",(0,i.jsx)(n.code,{children:"WEBHOOK_SECRET"})," with the exact secret set in the ",(0,i.jsx)(n.a,{href:"#1-register-webhook-in-github",children:"previous step"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"3-configure-horizontalrunnerautoscaler",children:"3. Configure HorizontalRunnerAutoscaler"}),"\n",(0,i.jsxs)(n.p,{children:["Create a YAML file to declare a ",(0,i.jsx)(n.strong,{children:"HorizontalRunnerAutoscaler"})," to automatically scale your runners based on workflow job events:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# horizontal-runner-autoscaler.yaml\napiVersion: actions.summerwind.dev/v1alpha1\nkind: HorizontalRunnerAutoscaler\nmetadata:\n  name: org-runners-autoscaler\n  namespace: github-actions\nspec:\n  minReplicas: 0\n  maxReplicas: 30\n  scaleTargetRef:\n    kind: RunnerDeployment\n    name: org-runners\n  scaleUpTriggers:\n    - duration: 30m\n      githubEvent:\n        workflowJob: {}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key configuration points:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"minReplicas"})," and ",(0,i.jsx)(n.code,{children:"maxReplicas"})," define the scaling range."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"scaleTargetRef"})," should reference the ",(0,i.jsx)(n.code,{children:"RunnerDeployment"})," resource managing your runners."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"scaleUpTriggers"})," listens for incoming ",(0,i.jsx)(n.code,{children:"workflow_job"})," events and scales up runners based on the specified duration after an event is received."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"Cold Start Issues",type:"danger",children:(0,i.jsxs)(n.p,{children:["Runners may experience ",(0,i.jsx)(n.strong,{children:"cold start"})," periods when ",(0,i.jsx)(n.strong,{children:"minimum replicas"})," is set to 0. If that's problematic for your setup, consider setting ",(0,i.jsx)(n.code,{children:"minReplicas: 1"})," for critical workflows."]})}),"\n",(0,i.jsxs)(n.p,{children:["Apply the ",(0,i.jsx)(n.strong,{children:"HorizontalRunnerAutoscaler"})," using the following command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f horizontal-runner-autoscaler.yaml\n"})}),"\n",(0,i.jsx)(n.h2,{id:"verifying",children:"Verifying"}),"\n",(0,i.jsx)(n.p,{children:"To ensure your self-hosted runners are properly configured and executing workflows as expected, follow these verification steps to monitor and validate runner behavior."}),"\n",(0,i.jsx)(n.h3,{id:"1-check-runner-registration-status",children:"1. Check Runner Registration Status"}),"\n",(0,i.jsx)(n.p,{children:"First, verify that your runners are successfully registered with GitHub:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Navigate to your GitHub organization ",(0,i.jsx)(n.strong,{children:"Settings"})]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Actions"})," and then select ",(0,i.jsx)(n.strong,{children:"Runners"})]}),"\n",(0,i.jsxs)(n.li,{children:["Confirm your self-hosted runners appear in the list with ",(0,i.jsx)(n.strong,{children:'"Idle"'})," or ",(0,i.jsx)(n.strong,{children:'"Active"'})," status"]}),"\n",(0,i.jsxs)(n.li,{children:["Note the runner labels (e.g., ",(0,i.jsx)(n.code,{children:"self-hosted"}),", ",(0,i.jsx)(n.code,{children:"linux"}),", ",(0,i.jsx)(n.code,{children:"cce-runner"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"Important",type:"warning",children:(0,i.jsxs)(n.p,{children:["If the ",(0,i.jsx)(n.strong,{children:"HorizontalRunnerAutoscaler"})," is resizing the runner replicas to 0, the runners will be removed from the pool and are not visible here. Make sure that you have at least one runner pod running on your cluster by changing the ",(0,i.jsx)(n.strong,{children:"minReplicas"})," of the ",(0,i.jsx)(n.strong,{children:"HorizontalPodAutoscaler"}),"."]})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"img",src:r(38890).A+"",width:"1029",height:"728"})}),"\n",(0,i.jsx)(n.admonition,{title:"Important",type:"danger",children:(0,i.jsxs)(n.p,{children:["Note that tags like ",(0,i.jsx)(n.strong,{children:"Linux"})," and ",(0,i.jsx)(n.strong,{children:"X64"})," here are generated by GitHub and are not associated with the runners unless you explicitly set them in the ",(0,i.jsx)(n.strong,{children:"RunnerDeployment"})," manifest. If a workflow uses labels that are not set in the ",(0,i.jsx)(n.strong,{children:"RunnerDeployment"})," manifest, their jobs will not be picked up by the runners or the ",(0,i.jsx)(n.strong,{children:"HorizontalRunnerAutoscaler"}),", and no runner scaling will happen."]})}),"\n",(0,i.jsx)(n.h3,{id:"2-create-a-test-workflow",children:"2. Create a Test Workflow"}),"\n",(0,i.jsxs)(n.p,{children:["Create a workflow file in your repository (e.g., ",(0,i.jsx)(n.code,{children:".github/workflows/self-hosted-test.yml"}),") to validate your self-hosted runners. This workflow tests basic functionality, system information, and network connectivity."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'name: Self-Hosted Runner Test\non:\n  workflow_dispatch:\n  push:\n    branches: [main]\n\njobs:\n  test-runner:\n    runs-on: [cce-runner]\n    steps:\n      - name: Runner Information\n        run: |\n          echo "Runner name: $RUNNER_NAME"\n          echo "Runner OS: $RUNNER_OS"\n          echo "Runner architecture: $RUNNER_ARCH"\n          echo "Workspace: $GITHUB_WORKSPACE"\n          \n      - name: System Information\n        run: |\n          echo "=== System Info ==="\n          uname -a\n          echo "=== CPU Info ==="\n          nproc\n          echo "=== Memory Info ==="\n          free -h\n          echo "=== Disk Space ==="\n          df -h\n          \n      - name: Kubernetes Context\n        run: |\n          echo "=== Pod Information ==="\n          echo "Hostname: $(hostname)"\n          echo "Pod IP: $(hostname -I)"\n          if command -v kubectl &> /dev/null; then\n            echo "Kubectl available"\n            kubectl version --client\n          fi\n          \n      - name: Network Connectivity\n        run: |\n          echo "=== Network Tests ==="\n          ping -c 3 google.com\n          curl -I https://api.github.com\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Run the workflow by navigating to ",(0,i.jsx)(n.strong,{children:"Actions -> Self-Hosted Runner Test"})," in your repository and clicking on the ",(0,i.jsx)(n.strong,{children:"Run workflow"})," button. Then monitor runners in real-time during workflow execution:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n github-actions -w\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can also check the ",(0,i.jsx)(n.strong,{children:"Jobs"})," under ",(0,i.jsx)(n.strong,{children:"Actions -> Self-Hosted Runner Test"})," in your repository."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"img",src:r(71861).A+"",width:"1129",height:"540"})}),"\n",(0,i.jsx)(n.h3,{id:"3-validate-autoscaling-behavior",children:"3. Validate Autoscaling Behavior"}),"\n",(0,i.jsx)(n.p,{children:"Test autoscaling by creating multiple concurrent workflow runs. This tests if your HorizontalRunnerAutoscaler responds correctly to increased demand."}),"\n",(0,i.jsx)(n.p,{children:"Check HorizontalRunnerAutoscaler status by running:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get hra -n github-actions\n\n# Output:\n# NAME                     MIN   MAX   DESIRED   SCHEDULE\n# org-runners-autoscaler   0     30    3\n"})}),"\n",(0,i.jsx)(n.p,{children:"You should see the number of pods increase as the number of concurrent workflows increases."}),"\n",(0,i.jsx)(n.h2,{id:"security-best-practices",children:"Security Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"network-security",children:"Network Security"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Isolate Runners"}),": Deploy runners in dedicated namespaces with network policies."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Egress Controls"}),": Configure allow-list policies for outbound connections."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"access-control",children:"Access Control"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Repository Restrictions"}),": Limit self-hosted runners to specific repositories."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"runtime-security",children:"Runtime Security"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Ephemeral Runners"}),": Use ephemeral runners that are destroyed after each job."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting-common-issues",children:"Troubleshooting Common Issues"}),"\n",(0,i.jsx)(n.p,{children:"When runners aren't receiving jobs, check registration tokens, labels, and webhook configuration."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Runner Not Picking Up Jobs:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Check runner registration credentials are correct:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get secret controller-manager -n github-actions -o json | jq '.data | map_values(@base64d)'\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Verify runner labels match workflow requirements:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl describe runnerdeployment org-runners -n github-actions\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Check webhook delivery in ",(0,i.jsx)(n.strong,{children:"Organization Settings -> Webhooks"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Scaling Issues:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Check webhook secret is correct:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get secret github-webhook-token -n github-actions -o json | jq '.data | map_values(@base64d)'\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Verify webhook server is running:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl https://github-webhook.example.com/health\n"})}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},10216:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/Install-app-c08f646ef47bc303337bd0793a310747.png"},27666:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/add-webhook-992cd71be42e9e4754116b16b452ef01.png"},1021:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/app-permissions-39ab475bc4d6b4d74889aa99de503af1.png"},755:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/new-app-9c72afda90e830454730bc0d3dedffd0.png"},46626:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/organization-settings-5713aa51f2c5456609c855bc74fda795.png"},38890:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/runners-c773e8268112d9bd7ee87d0fa02ddd5d.png"},71861:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/test-workflow-105c1e67a177a69ed79de65eb1284a6a.png"},28453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>l});var s=r(96540);const i={},t=s.createContext(i);function o(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);