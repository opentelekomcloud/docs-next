"use strict";(self.webpackChunkdocs_next=self.webpackChunkdocs_next||[]).push([[60166],{98084:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"best-practices/containers/cloud-container-engine/backup-kubernetes-objects","title":"Backing Up Kubernetes Objects of other Clusters","description":"In this part of the guide, we are going to demonstrate how we can backup WordPress with Velero (FSB). For WordPress, we need to backup both namespace resources (Deployments, Services, Secrets, ConfigMaps) and persistent volumes (MySQL and WordPress content).","source":"@site/docs/best-practices/containers/cloud-container-engine/backup-kubernetes-objects.md","sourceDirName":"best-practices/containers/cloud-container-engine","slug":"/best-practices/containers/cloud-container-engine/backup-kubernetes-objects","permalink":"/docs-next/pr-preview/pr-321/docs/best-practices/containers/cloud-container-engine/backup-kubernetes-objects","draft":false,"unlisted":false,"editUrl":"https://github.com/opentelekomcloud/docs-next/tree/main/docs/best-practices/containers/cloud-container-engine/backup-kubernetes-objects.md","tags":[{"inline":true,"label":"cce","permalink":"/docs-next/pr-preview/pr-321/docs/tags/cce"},{"inline":true,"label":"migration","permalink":"/docs-next/pr-preview/pr-321/docs/tags/migration"},{"inline":true,"label":"minio","permalink":"/docs-next/pr-preview/pr-321/docs/tags/minio"},{"inline":true,"label":"velero","permalink":"/docs-next/pr-preview/pr-321/docs/tags/velero"},{"inline":true,"label":"obs","permalink":"/docs-next/pr-preview/pr-321/docs/tags/obs"},{"inline":true,"label":"wordpress","permalink":"/docs-next/pr-preview/pr-321/docs/tags/wordpress"},{"inline":true,"label":"kubernetes","permalink":"/docs-next/pr-preview/pr-321/docs/tags/kubernetes"},{"inline":true,"label":"aws","permalink":"/docs-next/pr-preview/pr-321/docs/tags/aws"},{"inline":true,"label":"eks","permalink":"/docs-next/pr-preview/pr-321/docs/tags/eks"}],"version":"current","frontMatter":{"id":"backup-kubernetes-objects","title":"Backing Up Kubernetes Objects of other Clusters","tags":["cce","migration","minio","velero","obs","wordpress","kubernetes","aws","eks"]},"sidebar":"bestPracticesSidebar","previous":{"title":"Migrating Clusters from Other Clouds to CCE","permalink":"/docs-next/pr-preview/pr-321/docs/best-practices/containers/cloud-container-engine/migrating-from-other_clouds-to-cce"},"next":{"title":"Restoring Kubernetes Objects in a CCE Cluster","permalink":"/docs-next/pr-preview/pr-321/docs/best-practices/containers/cloud-container-engine/restore-kubernetes-objects"}}');var o=s(74848),r=s(28453);const a={id:"backup-kubernetes-objects",title:"Backing Up Kubernetes Objects of other Clusters",tags:["cce","migration","minio","velero","obs","wordpress","kubernetes","aws","eks"]},i="Backing Up Kubernetes Objects of other Clusters",c={},l=[{value:"Option 1: Automatically Back Up All Volumes (FSB)",id:"option-1-automatically-back-up-all-volumes-fsb",level:2},{value:"Option 2: Backup Specific Volumes via Annotations (FSB)",id:"option-2-backup-specific-volumes-via-annotations-fsb",level:2}];function p(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"backing-up-kubernetes-objects-of-other-clusters",children:"Backing Up Kubernetes Objects of other Clusters"})}),"\n",(0,o.jsx)(t.p,{children:"In this part of the guide, we are going to demonstrate how we can backup WordPress with Velero (FSB). For WordPress, we need to backup both namespace resources (Deployments, Services, Secrets, ConfigMaps) and persistent volumes (MySQL and WordPress content)."}),"\n",(0,o.jsx)(t.admonition,{type:"important",children:(0,o.jsx)(t.p,{children:"The following actions have to be performed on the AWK EKS cluster which is our migration source."})}),"\n",(0,o.jsx)(t.h2,{id:"option-1-automatically-back-up-all-volumes-fsb",children:"Option 1: Automatically Back Up All Volumes (FSB)"}),"\n",(0,o.jsx)(t.p,{children:"We need to enable automatic FSB for all volumes in the namespace:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-shell",children:"velero backup create wp-backup-auto \\\n  --include-namespaces wordpress \\\n  --default-volumes-to-fs-backup \n"})}),"\n",(0,o.jsx)(t.p,{children:"Velero will then automatically detect all PVCs in the namespace and back them up using the Node Agent. In order to verify the status of our backup we could execute the following commands:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-shell",children:"velero backup get\nvelero backup describe wp-backup-auto\n"})}),"\n",(0,o.jsx)(t.p,{children:"or simply follow the progress of the backup directly from the WebUI, we previously installed:"}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"image1",src:s(83638).A+"",width:"1913",height:"872"})}),"\n",(0,o.jsxs)(t.admonition,{type:"note",children:[(0,o.jsxs)(t.p,{children:["When Velero runs a backup using File System Backup (FSB), it creates two types of folders in the object storage bucket: ",(0,o.jsx)(t.code,{children:"backups"})," and ",(0,o.jsx)(t.code,{children:"kopia"}),"."]}),(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"backups"})," folder contains the metadata for Velero backups as details about Kubernetes resources (Deployments, Services, PVCs, etc.), backup status, and instructions for how a restore should be performed. ",(0,o.jsx)(t.em,{children:"This information lets Velero reconstruct the cluster state"}),"."]}),(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"kopia"})," folder is created by the Velero Node Agent (Restic integration). It stores the actual file system snapshots of the persistent volumes, managed by the ",(0,o.jsx)(t.a,{href:"https://kopia.io/",children:"Kopia"})," tool. ",(0,o.jsx)(t.em,{children:"These files represent the volume data at backup time and are used during restore to repopulate PVCs with their original content"}),"."]}),(0,o.jsxs)(t.p,{children:["Together, ",(0,o.jsx)(t.code,{children:"backups"})," holds the cluster definitions, while ",(0,o.jsx)(t.code,{children:"kopia"})," holds the persistent data. Both are needed for a full and consistent restore."]})]}),"\n",(0,o.jsx)(t.h2,{id:"option-2-backup-specific-volumes-via-annotations-fsb",children:"Option 2: Backup Specific Volumes via Annotations (FSB)"}),"\n",(0,o.jsx)(t.p,{children:"In this case we are going to annotate only specific pods, with the volumes we want backed up. Annotate the MySQL pod for Velero FSB:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-shell",children:"kubectl annotate pod/mysql-846d76b69c-rtgj4 \\\n  backup.velero.io/backup-volumes=mysql-data \\\n  -n wordpress\n"})}),"\n",(0,o.jsx)(t.p,{children:"and accordingly the WordPress pod:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-shell",children:"kubectl annotate pod/wordpress-68c77c8464-gc7hr \\\n  backup.velero.io/backup-volumes=wp-data \\\n  -n wordpress\n"})}),"\n",(0,o.jsxs)(t.p,{children:["After annotating, create a Velero backup that will include ",(0,o.jsx)(t.strong,{children:"only"})," these annotated volumes:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-shell",children:"velero backup create wp-backup-annotated-pods \\\n  --include-namespaces wordpress\n"})}),"\n",(0,o.jsx)(t.p,{children:"and finally verify as outlined in the previous option."}),"\n",(0,o.jsx)(t.admonition,{title:"REMEMBER",type:"danger",children:(0,o.jsxs)(t.p,{children:["If you annotate volumes of storage class ",(0,o.jsx)(t.code,{children:"HostPath"}),", ",(0,o.jsx)(t.strong,{children:"the storage volumes of this type will be automatically skipped"})," and a warning message will be generated. This will not cause a backup failure."]})})]})}function d(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(p,{...e})}):p(e)}},83638:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/Screenshot_from_2025-09-10_15-55-16-af3035cc636ca153588e010a5540b4fd.png"},28453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>i});var n=s(96540);const o={},r=n.createContext(o);function a(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);