"use strict";(self.webpackChunkdocs_next=self.webpackChunkdocs_next||[]).push([[49022],{20860:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics/auto-scaling-based-on-elb-monitoring-metrics-with-keda","title":"Auto Scaling Based on ELB Monitoring Metrics with KEDA","description":"This article demonstrates how to implement auto scaling using KEDA (Kubernetes Event-driven Autoscaling) with ELB monitoring metrics.","source":"@site/docs/best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics/auto-scaling-based-on-elb-monitoring-metrics-with-keda.md","sourceDirName":"best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics","slug":"/best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics/auto-scaling-based-on-elb-monitoring-metrics-with-keda","permalink":"/docs-next/pr-preview/pr-322/docs/best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics/auto-scaling-based-on-elb-monitoring-metrics-with-keda","draft":false,"unlisted":false,"editUrl":"https://github.com/opentelekomcloud/docs-next/tree/main/docs/best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics/auto-scaling-based-on-elb-monitoring-metrics-with-keda.md","tags":[{"inline":true,"label":"cce","permalink":"/docs-next/pr-preview/pr-322/docs/tags/cce"},{"inline":true,"label":"elb","permalink":"/docs-next/pr-preview/pr-322/docs/tags/elb"},{"inline":true,"label":"hpa","permalink":"/docs-next/pr-preview/pr-322/docs/tags/hpa"},{"inline":true,"label":"prometheus","permalink":"/docs-next/pr-preview/pr-322/docs/tags/prometheus"},{"inline":true,"label":"keda","permalink":"/docs-next/pr-preview/pr-322/docs/tags/keda"},{"inline":true,"label":"cloudeye","permalink":"/docs-next/pr-preview/pr-322/docs/tags/cloudeye"}],"version":"current","frontMatter":{"id":"auto-scaling-based-on-elb-monitoring-metrics-with-keda","title":"Auto Scaling Based on ELB Monitoring Metrics with KEDA","tags":["cce","elb","hpa","prometheus","keda","cloudeye"]},"sidebar":"bestPracticesSidebar","previous":{"title":"Auto Scaling Based on ELB Monitoring Metrics","permalink":"/docs-next/pr-preview/pr-322/docs/best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics/"},"next":{"title":"Auto Scaling Based on ELB Monitoring Metrics with Prometheus Adapter","permalink":"/docs-next/pr-preview/pr-322/docs/best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics/auto-scaling-based-on-elb-monitoring-metrics-with-prometheus-adapter"}}');var s=i(74848),a=i(28453);const o={id:"auto-scaling-based-on-elb-monitoring-metrics-with-keda",title:"Auto Scaling Based on ELB Monitoring Metrics with KEDA",tags:["cce","elb","hpa","prometheus","keda","cloudeye"]},c="Auto Scaling Based on ELB Monitoring Metrics with KEDA",r={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Solution Design",id:"solution-design",level:2},{value:"Installing KEDA",id:"installing-keda",level:2},{value:"Installing KEDA with Helm",id:"installing-keda-with-helm",level:3},{value:"Verifying KEDA Installation",id:"verifying-keda-installation",level:3},{value:"Creating a ScaledObject",id:"creating-a-scaledobject",level:2},{value:"Basic ScaledObject Configuration",id:"basic-scaledobject-configuration",level:3},{value:"Advanced ScaledObject Configuration",id:"advanced-scaledobject-configuration",level:3},{value:"Applying the ScaledObject",id:"applying-the-scaledobject",level:3},{value:"Testing the Scaling",id:"testing-the-scaling",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"auto-scaling-based-on-elb-monitoring-metrics-with-keda",children:"Auto Scaling Based on ELB Monitoring Metrics with KEDA"})}),"\n",(0,s.jsxs)(n.p,{children:["This article demonstrates how to implement auto scaling using ",(0,s.jsx)(n.a,{href:"https://keda.sh/",children:"KEDA (Kubernetes Event-driven Autoscaling)"})," with ELB monitoring metrics."]}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.p,{children:["Before following this guide, ensure you have completed the environment setup as described ",(0,s.jsx)(n.a,{href:"/docs-next/pr-preview/pr-322/docs/best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics/",children:"here"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Additionally, you need:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Basic understanding of KEDA concepts including ",(0,s.jsx)(n.strong,{children:"ScaledObject"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"solution-design",children:"Solution Design"}),"\n",(0,s.jsx)(n.p,{children:"This section describes an auto scaling solution based on ELB monitoring metrics using KEDA. Compared with CPU/memory usage-based auto scaling, KEDA-based auto scaling using ELB QPS data is more targeted, timely, and provides additional features such as scaling to/from zero.\nKEDA acts as a bridge between external metric sources and Kubernetes scaling decisions."}),"\n",(0,s.jsx)(n.p,{children:"The implementation scheme is as follows:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Set a ScaledObject to use ELB monitoring data as auto scaling metrics"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Benefits of KEDA over HPA:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Scale to/from Zero"}),": KEDA can scale workloads down to zero replicas during idle periods, saving resources"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Multiple Scalers"}),": Can combine different triggers (CPU, custom metrics, external APIs)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Figure 1 ELB traffic flows and monitoring\ndata",src:i(51585).A+"",width:"1327",height:"795"})}),"\n",(0,s.jsx)(n.h2,{id:"installing-keda",children:"Installing KEDA"}),"\n",(0,s.jsx)(n.h3,{id:"installing-keda-with-helm",children:"Installing KEDA with Helm"}),"\n",(0,s.jsx)(n.p,{children:"On the bastion host, install KEDA using Helm:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\nhelm repo add kedacore https://kedacore.github.io/charts\nhelm repo update\nkubectl create namespace keda\nhelm install keda kedacore/keda --namespace keda\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"verifying-keda-installation",children:"Verifying KEDA Installation"}),"\n",(0,s.jsx)(n.p,{children:"Verify that KEDA is running properly:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\nkubectl get pods -n keda\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"You should see the KEDA operator and metrics server pods running."}),"\n",(0,s.jsx)(n.h2,{id:"creating-a-scaledobject",children:"Creating a ScaledObject"}),"\n",(0,s.jsx)(n.p,{children:"After that the data is being reported by the exporter to Prometheus, you can create a ScaledObject policy for auto scaling."}),"\n",(0,s.jsx)(n.h3,{id:"basic-scaledobject-configuration",children:"Basic ScaledObject Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["Create a ",(0,s.jsx)(n.strong,{children:"ScaledObject"})," custom resource. The inbound traffic of the ELB load balancer is used to trigger scale-out. When the value of ",(0,s.jsx)(n.code,{children:"m4_ncps"})," (new connections per second) exceeds ",(0,s.jsx)(n.code,{children:"100"}),", the nginx Deployment will be scaled."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="nginx-scaledobject.yaml"',children:"apiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: nginx\n  namespace: default\nspec:\n  scaleTargetRef:\n    name: nginx\n  minReplicaCount: 1\n  maxReplicaCount: 10\n  cooldownPeriod: 300  \n  triggers:\n  - type: prometheus\n    metadata:\n      serverAddress: http://prometheus-kube-prometheus-prometheus.monitoring.svc.cluster.local:9090\n      threshold: '100'\n      query: opentelekomcloud_sys_elb_m4_ncps{lbaas_instance_id=\"INSTANCE_ID\"} # Replace INSTANCE_ID with your ELB instance ID\n      activationThreshold: '20'  \n"})}),"\n",(0,s.jsx)(n.admonition,{type:"important",children:(0,s.jsx)(n.p,{children:"The scaledObject must be created in the same namespace as the target Deployment."})}),"\n",(0,s.jsx)(n.h3,{id:"advanced-scaledobject-configuration",children:"Advanced ScaledObject Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["For production environments, you may need more advanced configurations. For example, you can combine multiple metrics (new connections and concurrent connections) to make scaling decisions. You can also adjust parameters like ",(0,s.jsx)(n.code,{children:"pollingInterval"})," and ",(0,s.jsx)(n.code,{children:"cooldownPeriod"})," to fine-tune the scaling behavior."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="nginx-scaledobject.yaml"',children:'apiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: nginx\n  namespace: default\nspec:\n  scaleTargetRef:\n    name: nginx\n  minReplicaCount: 1\n  maxReplicaCount: 20\n  pollingInterval: 15  # Check metrics every 15 seconds\n  cooldownPeriod: 180  # Wait 3 minutes before scaling down\n  advanced:\n    scalingModifiers:\n      target: "100"\n      activationTarget: "20"\n      metricType: "AverageValue"\n      # Combine new connections and concurrent connections\n      formula: "new_connections * 2 + concurrent_connections * 0.1"\n  triggers:\n  - type: prometheus\n    name: new_connections\n    metadata:\n      serverAddress: http://prometheus-kube-prometheus-prometheus.monitoring.svc.cluster.local:9090\n      query: opentelekomcloud_sys_elb_m4_ncps{lbaas_instance_id="INSTANCE_ID"} # Replace INSTANCE_ID with your ELB instance ID\n      threshold: \'1\'  # Will be overridden by scalingModifiers\n  - type: prometheus  \n    name: concurrent_connections\n    metadata:\n      serverAddress: http://prometheus-kube-prometheus-prometheus.monitoring.svc.cluster.local:9090\n      query: opentelekomcloud_sys_elb_m1_cps{lbaas_instance_id="INSTANCE_ID"} # Replace INSTANCE_ID with your ELB instance ID\n      threshold: \'1\'  # Will be overridden by scalingModifiers\n'})}),"\n",(0,s.jsx)(n.h3,{id:"applying-the-scaledobject",children:"Applying the ScaledObject"}),"\n",(0,s.jsx)(n.p,{children:"Apply the ScaledObject configuration:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f nginx-scaledobject.yaml\n"})}),"\n",(0,s.jsx)(n.h3,{id:"testing-the-scaling",children:"Testing the Scaling"}),"\n",(0,s.jsx)(n.p,{children:"After the ScaledObject is created, perform a pressure test on the workload (accessing the pods through ELB). Then, the KEDA scaler determines whether scaling is required based on the configured value."}),"\n",(0,s.jsx)(n.p,{children:"Monitor the scaling events:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl get scaledobject nginx -w\n# KEDA creates HPA objects internally\nkubectl get hpa -w \n"})})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},51585:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/keda-4f06bfbe8103395eebc46db362359362.png"},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var t=i(96540);const s={},a=t.createContext(s);function o(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);