"use strict";(self.webpackChunkdocs_next=self.webpackChunkdocs_next||[]).push([[30583],{74837:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"blueprints/by-use-case/observability/aggregate-cce-logs-with-fluentbit-and-grafana-loki","title":"Aggregate CCE Logs with Fluent Bit & Grafana Loki","description":"This blueprint explains how to collect and centralize logs from Cloud Container Engine (CCE) workloads using Fluent Bit and Grafana Loki. It covers the end-to-end setup for forwarding logs from CCE nodes and containers to a centralized Loki instance, enabling efficient querying, visualization, and troubleshooting through Grafana dashboards. The goal is to provide a consistent and scalable logging approach for Kubernetes environments running on Open Telekom Cloud.","source":"@site/docs/blueprints/by-use-case/observability/aggregate-cce-logs-with-fluentbit-and-grafana-loki.md","sourceDirName":"blueprints/by-use-case/observability","slug":"/blueprints/by-use-case/observability/aggregate-cce-logs-with-fluentbit-and-grafana-loki","permalink":"/docs-next/pr-preview/pr-327/docs/blueprints/by-use-case/observability/aggregate-cce-logs-with-fluentbit-and-grafana-loki","draft":false,"unlisted":false,"editUrl":"https://github.com/opentelekomcloud/docs-next/tree/main/docs/blueprints/by-use-case/observability/aggregate-cce-logs-with-fluentbit-and-grafana-loki.md","tags":[{"inline":true,"label":"cce","permalink":"/docs-next/pr-preview/pr-327/docs/tags/cce"},{"inline":true,"label":"observability","permalink":"/docs-next/pr-preview/pr-327/docs/tags/observability"},{"inline":true,"label":"logging","permalink":"/docs-next/pr-preview/pr-327/docs/tags/logging"},{"inline":true,"label":"grafana","permalink":"/docs-next/pr-preview/pr-327/docs/tags/grafana"},{"inline":true,"label":"loki","permalink":"/docs-next/pr-preview/pr-327/docs/tags/loki"},{"inline":true,"label":"fluent-bit","permalink":"/docs-next/pr-preview/pr-327/docs/tags/fluent-bit"}],"version":"current","sidebarPosition":3,"frontMatter":{"id":"aggregate-cce-logs-with-fluentbit-and-grafana-loki","title":"Aggregate CCE Logs with Fluent Bit & Grafana Loki","tags":["cce","observability","logging","grafana","loki","fluent-bit"],"sidebar_position":3},"sidebar":"blueprintsSidebar","previous":{"title":"Aggregate CCE Logs with Promtail & Grafana Loki","permalink":"/docs-next/pr-preview/pr-327/docs/blueprints/by-use-case/observability/aggregate-cce-logs-with-promtail-and-grafana-loki"},"next":{"title":"Security","permalink":"/docs-next/pr-preview/pr-327/docs/blueprints/by-use-case/security/"}}');var i=a(74848),r=a(28453);const s={id:"aggregate-cce-logs-with-fluentbit-and-grafana-loki",title:"Aggregate CCE Logs with Fluent Bit & Grafana Loki",tags:["cce","observability","logging","grafana","loki","fluent-bit"],sidebar_position:3},o="Aggregate CCE Logs with Fluent Bit & Grafana Loki",l={},c=[{value:"Installing Grafana Loki",id:"installing-grafana-loki",level:2},{value:"Installing Fluent Bit as Log Forwarder",id:"installing-fluent-bit-as-log-forwarder",level:2},{value:"Installing Grafana (Optional)",id:"installing-grafana-optional",level:2}];function d(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"aggregate-cce-logs-with-fluent-bit--grafana-loki",children:"Aggregate CCE Logs with Fluent Bit & Grafana Loki"})}),"\n",(0,i.jsxs)(n.p,{children:["This blueprint explains how to collect and centralize logs from Cloud Container Engine (CCE) workloads using ",(0,i.jsx)(n.a,{href:"https://fluentbit.io/",children:"Fluent Bit"})," and ",(0,i.jsx)(n.a,{href:"https://grafana.com/oss/loki/",children:"Grafana Loki"}),". It covers the end-to-end setup for forwarding logs from CCE nodes and containers to a centralized Loki instance, enabling efficient querying, visualization, and troubleshooting through Grafana dashboards. The goal is to provide a consistent and scalable logging approach for Kubernetes environments running on Open Telekom Cloud."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://fluentbit.io/",children:"Fluent Bit"})," is a lightweight, high-performance log and metrics processor designed for cloud and containerized environments. It collects data from various sources, processes and filters it, and then forwards it to multiple destinations such as Loki, Elasticsearch, or cloud logging services. Built with minimal resource consumption in mind, Fluent Bit integrates seamlessly with Kubernetes through ",(0,i.jsx)(n.code,{children:"DaemonSets"}),", making it an efficient choice for aggregating logs from all nodes and containers in a cluster."]}),"\n",(0,i.jsx)(n.h2,{id:"installing-grafana-loki",children:"Installing Grafana Loki"}),"\n",(0,i.jsxs)(n.p,{children:["If you don\u2019t already have a Grafana Loki instance running, you can set it up first before proceeding with log aggregation. The installation process is covered in detail in the companion blueprint ",(0,i.jsx)(n.a,{href:"/docs/blueprints/by-use-case/observability/deploy-grafana-loki-on-cce",children:"Deploy Grafana Loki on CCE"}),", which explains how to deploy Loki in microservices mode on Cloud Container Engine (CCE) with Open Telekom Cloud Object Storage (OBS) as the backend. Once Loki is up and running, you can continue here to install and configure Fluent-Bit and start collecting and centralizing logs from your CCE workloads."]}),"\n",(0,i.jsx)(n.h2,{id:"installing-fluent-bit-as-log-forwarder",children:"Installing Fluent Bit as Log Forwarder"}),"\n",(0,i.jsxs)(n.p,{children:["Fluent Bit, as already mentioned, acts as the central log collector in the cluster, running as a ",(0,i.jsx)(n.code,{children:"DaemonSet"}),", collecting logs from every node and container in the CCE cluster, parsing and enriching them with Kubernetes metadata, and finally forwarding them to Grafana Loki."]}),"\n",(0,i.jsxs)(n.p,{children:["Create a values file called ",(0,i.jsx)(n.strong,{children:"values-fluentbit.yaml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="values-fluentbit.yaml"',children:"elasticsearch:\n  enabled: false\n\nopensearch:\n  enabled: false\n\nkind: DaemonSet\n\nconfig:\n  service: |\n    [SERVICE]\n        Daemon Off\n        Flush 1\n        Log_Level info\n        Parsers_File /fluent-bit/etc/parsers.conf\n        Parsers_File /fluent-bit/etc/conf/custom_parsers.conf\n        HTTP_Server On\n        HTTP_Listen 0.0.0.0\n        HTTP_Port 2020\n        Health_Check On\n\n  inputs: |\n    [INPUT]\n        Name tail\n        Path /var/log/containers/*.log\n        Exclude_Path /var/log/containers/*fluent-bit*.log\n        multiline.parser docker, cri\n        Tag kube.*\n        Mem_Buf_Limit 50MB\n        Skip_Long_Lines On\n        Refresh_Interval 10\n\n  filters: |\n    [FILTER]\n        Name kubernetes\n        Match kube.*\n        Kube_URL https://kubernetes.default.svc:443\n        Kube_CA_File /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n        Kube_Token_File /var/run/secrets/kubernetes.io/serviceaccount/token\n        Kube_Tag_Prefix kube.var.log.containers.\n        Merge_Log On\n        Keep_Log On\n        K8S-Logging.Parser On\n        K8S-Logging.Exclude On\n        Labels Off\n        Annotations Off\n\n    [FILTER]\n        Name modify\n        Match kube.*\n        Remove stream\n        Remove time\n        Remove kubernetes.container_hash\n        Remove kubernetes.pod_id\n\n  outputs: |\n    [OUTPUT]\n        Name loki\n        Match kube.*\n        Host loki-gateway.monitoring.svc.cluster.local\n        Port 80\n        uri /loki/api/v1/push\n        labels job=fluent-bit, namespace=$kubernetes['namespace_name'], pod=$kubernetes['pod_name'], container=$kubernetes['container_name']\n        remove_keys kubernetes,host,container_id,_p\n        line_format key_value\n        drop_single_key raw\n        auto_kubernetes_labels off\n\n  customParsers: |\n    [PARSER]\n        Name docker_no_time\n        Format json\n        Time_Keep Off\n        Time_Key time\n        Time_Format %Y-%m-%dT%H:%M:%S.%L\n\nresources:\n  requests:\n    cpu: 100m\n    memory: 128Mi\n  limits:\n    cpu: 500m\n    memory: 256Mi\n\ntolerations:\n  - operator: Exists\n    effect: NoSchedule\n  - operator: Exists\n    effect: NoExecute\n\nsecurityContext:\n  runAsNonRoot: true\n  runAsUser: 1000\n  readOnlyRootFilesystem: true\n  allowPrivilegeEscalation: false\n  capabilities:\n    drop:\n      - ALL\n\nserviceMonitor:\n  enabled: false\n\nhostNetwork: false\ndnsPolicy: ClusterFirst\n"})}),"\n",(0,i.jsx)(n.p,{children:"and deploy via Helm:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm repo add fluent https://fluent.github.io/helm-charts\nhelm repo update\n\nhelm upgrade --install fluent-bit fluent/fluent-bit   \\\n-f values-fluentbit.yaml \\\n--namespace monitoring --create-namespace \\\n--reset-values\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["For detailed guidance on configuring the Kubernetes filter, refer to the ",(0,i.jsx)(n.a,{href:"https://docs.fluentbit.io/manual/data-pipeline/filters/kubernetes",children:"Fluent Bit official documentation"}),"."]})}),"\n",(0,i.jsx)(n.h2,{id:"installing-grafana-optional",children:"Installing Grafana (Optional)"}),"\n",(0,i.jsxs)(n.p,{children:["For verification, we\u2019ll install Grafana with Helm and include a simple demo dashboard to confirm that logs are reaching Loki. This lightweight setup is only for validation and smoke testing. For most production clusters, the recommended approach is to deploy the ",(0,i.jsx)(n.a,{href:"https://github.com/prometheus-community/helm-charts/blob/main/charts/kube-prometheus-stack/README.md",children:"kube-prometheus-stack"})," bundle, which provides Grafana together with Prometheus, Alertmanager, and curated dashboards, offering tighter integration and easier ongoing operations."]}),"\n",(0,i.jsxs)(n.p,{children:["Create a values file called ",(0,i.jsx)(n.strong,{children:"values-grafana.yaml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="values-promtail.yaml"',children:'adminUser: admin\n\npersistence:\n  enabled: true\n  size: 5Gi\n  accessModes:\n    - ReadWriteOnce\n  storageClassName: "csi-disk"\n\nservice:\n  enabled: true\n  type: ClusterIP\n  port: 80\n\nresources:\n  requests:\n    cpu: 100m\n    memory: 256Mi\n  limits:\n    cpu: 500m\n    memory: 512Mi\n\ndatasources:\n  datasources.yaml:\n    apiVersion: 1\n    datasources:\n      - name: Loki\n        type: loki\n        access: proxy\n        url: http://loki-gateway.monitoring.svc.cluster.local\n        jsonData:\n          maxLines: 1000\n          derivedFields:\n            - datasourceUid: Loki\n              matcherRegex: "traceID=(\\\\w+)"\n              name: TraceID\n              url: "$${__value.raw}"\n        isDefault: true\n        editable: true\n\ndashboardProviders:\n  dashboardproviders.yaml:\n    apiVersion: 1\n    providers:\n      - name: \'default\'\n        orgId: 1\n        folder: \'\'\n        type: file\n        disableDeletion: false\n        editable: true\n        options:\n          path: /var/lib/grafana/dashboards/default\n\ndashboards:\n  default:\n    loki-logs:\n      gnetId: 18494\n      revision: 1\n      datasource: Loki\n\ngrafana.ini:\n  server:\n    root_url: "%(protocol)s://%(domain)s:%(http_port)s/"\n  analytics:\n    check_for_updates: true\n    check_for_plugin_updates: true\n  log:\n    mode: console\n  paths:\n    data: /var/lib/grafana/\n    logs: /var/log/grafana\n    plugins: /var/lib/grafana/plugins\n    provisioning: /etc/grafana/provisioning\n\nsecurityContext:\n  runAsNonRoot: true\n  runAsUser: 472\n  runAsGroup: 472\n  fsGroup: 472\n  allowPrivilegeEscalation: false\n  capabilities:\n    drop:\n      - ALL\n\nserviceMonitor:\n  enabled: false\n\nrbac:\n  create: true\n  pspEnabled: false\n\nserviceAccount:\n  create: true\n  autoMount: true\n'})}),"\n",(0,i.jsx)(n.p,{children:"and deploy via Helm:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'helm repo add grafana https://grafana.github.io/helm-charts\nhelm repo update\n\nhelm upgrade --install grafana grafana/grafana \\\n-f values-grafana.yaml \\\n-n monitoring --create-namespace \\\n--set "adminPassword=$(openssl rand -base64 24)" \\\n--reset values\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Go to ",(0,i.jsx)(n.em,{children:"Grafana"})," -> ",(0,i.jsx)(n.em,{children:"Dashboards"})," and click the dashboard we provisioned as bundle with the Helm Chart ",(0,i.jsx)(n.em,{children:"Loki Kubernetes Logs"}),":"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"image",src:a(51400).A+"",width:"1914",height:"887"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["\ud83d\udca1"," The Grafana admin password can be found in ",(0,i.jsx)(n.code,{children:"grafana"})," secret in monitoring namespace.",(0,i.jsx)(n.br,{}),"\n","\u26a0\ufe0f"," This Grafana installation and the provided ",(0,i.jsx)(n.a,{href:"https://grafana.com/grafana/dashboards/18494-kubernetes-logs-from-loki/",children:"dashboard"})," are intended for demonstration purposes only."]})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},51400:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/Screenshot_from_2025-10-09_11-09-06-fd5a4ce07b2ef9ed386965344ba2557d.png"},28453:(e,n,a)=>{a.d(n,{R:()=>s,x:()=>o});var t=a(96540);const i={},r=t.createContext(i);function s(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);