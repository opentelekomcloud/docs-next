"use strict";(self.webpackChunkdocs_next=self.webpackChunkdocs_next||[]).push([[49022],{5334:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics/auto-scaling-based-on-elb-monitoring-metrics-with-keda","title":"Auto Scaling Based on ELB Monitoring Metrics with KEDA","description":"This article demonstrates how to implement auto scaling using KEDA (Kubernetes Event-driven Autoscaling) with ELB monitoring metrics.","source":"@site/docs/best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics/auto-scaling-based-on-elb-monitoring-metrics-with-keda.md","sourceDirName":"best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics","slug":"/best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics/auto-scaling-based-on-elb-monitoring-metrics-with-keda","permalink":"/docs-next/pr-preview/pr-336/docs/best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics/auto-scaling-based-on-elb-monitoring-metrics-with-keda","draft":false,"unlisted":false,"editUrl":"https://github.com/opentelekomcloud/docs-next/tree/main/docs/best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics/auto-scaling-based-on-elb-monitoring-metrics-with-keda.md","tags":[{"inline":true,"label":"cce","permalink":"/docs-next/pr-preview/pr-336/docs/tags/cce"},{"inline":true,"label":"elb","permalink":"/docs-next/pr-preview/pr-336/docs/tags/elb"},{"inline":true,"label":"hpa","permalink":"/docs-next/pr-preview/pr-336/docs/tags/hpa"},{"inline":true,"label":"prometheus","permalink":"/docs-next/pr-preview/pr-336/docs/tags/prometheus"},{"inline":true,"label":"keda","permalink":"/docs-next/pr-preview/pr-336/docs/tags/keda"},{"inline":true,"label":"cloudeye","permalink":"/docs-next/pr-preview/pr-336/docs/tags/cloudeye"}],"version":"current","frontMatter":{"id":"auto-scaling-based-on-elb-monitoring-metrics-with-keda","title":"Auto Scaling Based on ELB Monitoring Metrics with KEDA","tags":["cce","elb","hpa","prometheus","keda","cloudeye"]},"sidebar":"bestPracticesSidebar","previous":{"title":"Auto Scaling Based on ELB Monitoring Metrics","permalink":"/docs-next/pr-preview/pr-336/docs/best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics/"},"next":{"title":"Auto Scaling Based on ELB Monitoring Metrics with Prometheus Adapter","permalink":"/docs-next/pr-preview/pr-336/docs/best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics/auto-scaling-based-on-elb-monitoring-metrics-with-prometheus-adapter"}}');var s=t(74848),a=t(28453);const o={id:"auto-scaling-based-on-elb-monitoring-metrics-with-keda",title:"Auto Scaling Based on ELB Monitoring Metrics with KEDA",tags:["cce","elb","hpa","prometheus","keda","cloudeye"]},c="Auto Scaling Based on ELB Monitoring Metrics with KEDA",r={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Solution Design",id:"solution-design",level:2},{value:"Key Benefits of KEDA over HPA",id:"key-benefits-of-keda-over-hpa",level:3},{value:"Installing KEDA",id:"installing-keda",level:2},{value:"Installing KEDA with Helm",id:"installing-keda-with-helm",level:3},{value:"Creating a ScaledObject",id:"creating-a-scaledobject",level:2},{value:"Basic ScaledObject Configuration",id:"basic-scaledobject-configuration",level:3},{value:"Advanced ScaledObject Configuration",id:"advanced-scaledobject-configuration",level:3},{value:"Applying the ScaledObject",id:"applying-the-scaledobject",level:3},{value:"Testing the Scaling",id:"testing-the-scaling",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"auto-scaling-based-on-elb-monitoring-metrics-with-keda",children:"Auto Scaling Based on ELB Monitoring Metrics with KEDA"})}),"\n",(0,s.jsxs)(n.p,{children:["This article demonstrates how to implement auto scaling using ",(0,s.jsx)(n.a,{href:"https://keda.sh/",children:"KEDA (Kubernetes Event-driven Autoscaling)"})," with ELB monitoring metrics."]}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.p,{children:["Before proceeding with this guide, make sure the environment setup described in ",(0,s.jsx)(n.a,{href:"/docs-next/pr-preview/pr-336/docs/best-practices/containers/cloud-container-engine/auto-scaling-based-on-elb-monitoring-metrics/",children:"this section"})," has been completed. You should also be familiar with the basic concepts of KEDA, particularly the ",(0,s.jsx)(n.strong,{children:"ScaledObject"})," resource."]}),"\n",(0,s.jsx)(n.h2,{id:"solution-design",children:"Solution Design"}),"\n",(0,s.jsxs)(n.p,{children:["This section outlines an auto scaling approach that leverages ELB monitoring metrics through KEDA. Unlike traditional scaling methods based on CPU or memory usage, using ELB QPS data enables faster and more precise scaling decisions, while also supporting advanced capabilities such as scaling workloads down to zero. KEDA functions as a mediator between external metric sources and Kubernetes, translating those metrics into scaling actions in real time. The core of this solution is configuring a ",(0,s.jsx)(n.strong,{children:"ScaledObject"})," to use ELB monitoring data as the metric source for automatic scaling decisions."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Figure 1 ELB traffic flows and monitoring\ndata",src:t(51585).A+"",width:"1327",height:"795"})}),"\n",(0,s.jsx)(n.h3,{id:"key-benefits-of-keda-over-hpa",children:"Key Benefits of KEDA over HPA"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Scale to/from Zero"}),": KEDA can reduce workloads to zero replicas during periods of inactivity, helping to optimize resource usage and lower costs."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Multiple Scalers"}),": It supports combining multiple scaling triggers, such as CPU utilization, custom metrics, or external API data."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"installing-keda",children:"Installing KEDA"}),"\n",(0,s.jsx)(n.h3,{id:"installing-keda-with-helm",children:"Installing KEDA with Helm"}),"\n",(0,s.jsx)(n.p,{children:"On a bastion host, install KEDA using Helm:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"helm repo add kedacore https://kedacore.github.io/charts\nhelm repo update\n\nhelm install keda kedacore/keda --namespace keda --create-namespace\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then verify that KEDA is running correctly; you should observe both the KEDA operator and the metrics server pods in a running state."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n keda\n"})}),"\n",(0,s.jsx)(n.h2,{id:"creating-a-scaledobject",children:"Creating a ScaledObject"}),"\n",(0,s.jsxs)(n.p,{children:["Once the exporter starts sending data to Prometheus, you can define a ",(0,s.jsx)(n.strong,{children:"ScaledObject"})," policy to enable automatic scaling based on those metrics."]}),"\n",(0,s.jsx)(n.h3,{id:"basic-scaledobject-configuration",children:"Basic ScaledObject Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["Create a ",(0,s.jsx)(n.strong,{children:"ScaledObject"})," custom resource that uses inbound ELB traffic as the scaling trigger. When the metric ",(0,s.jsx)(n.code,{children:"m4_ncps"})," (new connections per second) surpasses ",(0,s.jsx)(n.code,{children:"100"}),", the nginx ",(0,s.jsx)(n.strong,{children:"Deployment"})," will automatically scale out."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="nginx-scaledobject.yaml"',children:"apiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: nginx\n  namespace: default\nspec:\n  scaleTargetRef:\n    name: nginx\n  minReplicaCount: 1\n  maxReplicaCount: 10\n  cooldownPeriod: 300  \n  triggers:\n  - type: prometheus\n    metadata:\n      serverAddress: http://prometheus-kube-prometheus-prometheus.monitoring.svc.cluster.local:9090\n      threshold: '100'\n      query: opentelekomcloud_sys_elb_m4_ncps{lbaas_instance_id=\"INSTANCE_ID\"} # Replace INSTANCE_ID with your ELB instance ID\n      activationThreshold: '20'  \n"})}),"\n",(0,s.jsx)(n.admonition,{type:"important",children:(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"ScaledObject"})," must be deployed in the same namespace as the target ",(0,s.jsx)(n.strong,{children:"Deployment"}),"."]})}),"\n",(0,s.jsx)(n.h3,{id:"advanced-scaledobject-configuration",children:"Advanced ScaledObject Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["In production environments, more advanced configurations may be required. For instance, you can combine multiple metrics, such as new and concurrent connections, to drive scaling decisions. Parameters like ",(0,s.jsx)(n.code,{children:"pollingInterval"})," and ",(0,s.jsx)(n.code,{children:"cooldownPeriod"})," can also be adjusted to fine-tune how quickly the system reacts to changing traffic patterns."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="nginx-scaledobject.yaml"',children:'apiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: nginx\n  namespace: default\nspec:\n  scaleTargetRef:\n    name: nginx\n  minReplicaCount: 1\n  maxReplicaCount: 20\n  pollingInterval: 15  # Check metrics every 15 seconds\n  cooldownPeriod: 180  # Wait 3 minutes before scaling down\n  advanced:\n    scalingModifiers:\n      target: "100"\n      activationTarget: "20"\n      metricType: "AverageValue"\n      # Combine new connections and concurrent connections\n      formula: "new_connections * 2 + concurrent_connections * 0.1"\n  triggers:\n  - type: prometheus\n    name: new_connections\n    metadata:\n      serverAddress: http://prometheus-kube-prometheus-prometheus.monitoring.svc.cluster.local:9090\n      query: opentelekomcloud_sys_elb_m4_ncps{lbaas_instance_id="INSTANCE_ID"} # Replace INSTANCE_ID with your ELB instance ID\n      threshold: \'1\'  # Will be overridden by scalingModifiers\n  - type: prometheus  \n    name: concurrent_connections\n    metadata:\n      serverAddress: http://prometheus-kube-prometheus-prometheus.monitoring.svc.cluster.local:9090\n      query: opentelekomcloud_sys_elb_m1_cps{lbaas_instance_id="INSTANCE_ID"} # Replace INSTANCE_ID with your ELB instance ID\n      threshold: \'1\'  # Will be overridden by scalingModifiers\n'})}),"\n",(0,s.jsx)(n.h3,{id:"applying-the-scaledobject",children:"Applying the ScaledObject"}),"\n",(0,s.jsx)(n.p,{children:"Apply the ScaledObject configuration:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f nginx-scaledobject.yaml\n"})}),"\n",(0,s.jsx)(n.h3,{id:"testing-the-scaling",children:"Testing the Scaling"}),"\n",(0,s.jsxs)(n.p,{children:["After creating the ",(0,s.jsx)(n.strong,{children:"ScaledObject"}),", run a load test on the workload by sending traffic through the ELB. KEDA will monitor the configured metric and determine whether scaling actions are needed based on the defined thresholds. You can observe the scaling activity:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl get scaledobject nginx -w\n# KEDA creates HPA objects internally\nkubectl get hpa -w \n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},51585:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/keda-4f06bfbe8103395eebc46db362359362.png"},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var i=t(96540);const s={},a=i.createContext(s);function o(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);