<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-best-practices/management-and-deployment/cloud-trace/auditing-and-analyzing-logins-and-logouts-with-functiongraph" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Auditing and Analyzing Logins and Logouts with Functiongraph | Architecture Center</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://opentelekomcloud.github.io/docs-next/pr-preview/pr-336/img/open-telekom-cloud-social-card.png"><meta data-rh="true" name="twitter:image" content="https://opentelekomcloud.github.io/docs-next/pr-preview/pr-336/img/open-telekom-cloud-social-card.png"><meta data-rh="true" property="og:url" content="https://opentelekomcloud.github.io/docs-next/pr-preview/pr-336/docs/best-practices/management-and-deployment/cloud-trace/auditing-and-analyzing-logins-and-logouts-with-functiongraph"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Auditing and Analyzing Logins and Logouts with Functiongraph | Architecture Center"><meta data-rh="true" name="description" content="Cloud Trace Service (CTS) collects real-time records of operations on cloud resources. You can create a CTS trigger to obtain records of subscribed cloud resource operations, analyze and process the operation records, and report alarms. You can use Simple Message Notification (SMN) to push alarm messages to service personnel by SMS message or email. Figure 1 shows the procedure."><meta data-rh="true" property="og:description" content="Cloud Trace Service (CTS) collects real-time records of operations on cloud resources. You can create a CTS trigger to obtain records of subscribed cloud resource operations, analyze and process the operation records, and report alarms. You can use Simple Message Notification (SMN) to push alarm messages to service personnel by SMS message or email. Figure 1 shows the procedure."><link data-rh="true" rel="icon" href="/docs-next/pr-preview/pr-336/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://opentelekomcloud.github.io/docs-next/pr-preview/pr-336/docs/best-practices/management-and-deployment/cloud-trace/auditing-and-analyzing-logins-and-logouts-with-functiongraph"><link data-rh="true" rel="alternate" href="https://opentelekomcloud.github.io/docs-next/pr-preview/pr-336/docs/best-practices/management-and-deployment/cloud-trace/auditing-and-analyzing-logins-and-logouts-with-functiongraph" hreflang="en"><link data-rh="true" rel="alternate" href="https://opentelekomcloud.github.io/docs-next/pr-preview/pr-336/docs/best-practices/management-and-deployment/cloud-trace/auditing-and-analyzing-logins-and-logouts-with-functiongraph" hreflang="x-default"><link rel="preconnect" href="https://analytics.example.de">
<script async defer="defer" src="https://analytics.example.de/script.js" data-website-id="00000" data-host-url="https://analytics.example.de" data-auto-track="true" data-do-not-track="true" data-cache="true" data-domains="opentelekomcloud.github.io" data-exclude-search="false" data-exclude-hash="false"></script><link rel="stylesheet" href="/docs-next/pr-preview/pr-336/assets/css/styles.a4bbca19.css">
<script src="/docs-next/pr-preview/pr-336/assets/js/runtime~main.bc5a4978.js" defer="defer"></script>
<script src="/docs-next/pr-preview/pr-336/assets/js/main.fa477f60.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs-next/pr-preview/pr-336/"><div class="navbar__logo"><img src="/docs-next/pr-preview/pr-336/img/logo_headline_kombination_m_s_m.png" alt="Open Telekom Cloud Non-Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs-next/pr-preview/pr-336/img/logo_headline_kombination_m_w_m.png" alt="Open Telekom Cloud Non-Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs-next/pr-preview/pr-336/docs/best-practices/">Best Practices</a><a class="navbar__item navbar__link" href="/docs-next/pr-preview/pr-336/docs/blueprints/">Blueprints</a><a class="navbar__item navbar__link" href="/docs-next/pr-preview/pr-336/templates">Templates</a><a class="navbar__item navbar__link" href="/docs-next/pr-preview/pr-336/webinars">Webinars</a></div><div class="navbar__items navbar__items--right"><a href="https://auth.otc.t-systems.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar--terminal-link" aria-label="Open Telekom Cloud Console"></a><a href="https://status.otc-service.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar--sd-link" aria-label="GitHub"></a><div class="toggle_vylO colorModeToggle_x44X"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="light mode" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_dCNk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs-next/pr-preview/pr-336/docs/best-practices/"><span title="Best Practices" class="linkLabel_WmDU">Best Practices</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs-next/pr-preview/pr-336/docs/best-practices/application-services/application-operations-management"><span title="Application Services" class="categoryLinkLabel_W154">Application Services</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs-next/pr-preview/pr-336/docs/best-practices/big-data-and-data-analysis/cloud-search-service"><span title="Big Data &amp; Data Analysis" class="categoryLinkLabel_W154">Big Data &amp; Data Analysis</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs-next/pr-preview/pr-336/docs/best-practices/computing/auto-scaling"><span title="Computing" class="categoryLinkLabel_W154">Computing</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs-next/pr-preview/pr-336/docs/best-practices/containers/application-service-mesh"><span title="Containers" class="categoryLinkLabel_W154">Containers</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs-next/pr-preview/pr-336/docs/best-practices/databases/distributed-cache-service"><span title="Databases" class="categoryLinkLabel_W154">Databases</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs-next/pr-preview/pr-336/docs/best-practices/management-and-deployment/cloud-create/"><span title="Management &amp; Deployment" class="categoryLinkLabel_W154">Management &amp; Deployment</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs-next/pr-preview/pr-336/docs/best-practices/management-and-deployment/cloud-create/"><span title="Cloud Create" class="categoryLinkLabel_W154">Cloud Create</span></a><button aria-label="Expand sidebar category &#x27;Cloud Create&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs-next/pr-preview/pr-336/docs/best-practices/management-and-deployment/cloud-eye"><span title="Cloud Eye" class="categoryLinkLabel_W154">Cloud Eye</span></a><button aria-label="Expand sidebar category &#x27;Cloud Eye&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs-next/pr-preview/pr-336/docs/best-practices/management-and-deployment/config"><span title="Config" class="categoryLinkLabel_W154">Config</span></a><button aria-label="Expand sidebar category &#x27;Config&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs-next/pr-preview/pr-336/docs/best-practices/management-and-deployment/cloud-trace"><span title="Cloud Trace Service" class="categoryLinkLabel_W154">Cloud Trace Service</span></a><button aria-label="Collapse sidebar category &#x27;Cloud Trace Service&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs-next/pr-preview/pr-336/docs/best-practices/management-and-deployment/cloud-trace/auditing-and-analyzing-logins-and-logouts-with-functiongraph"><span title="Auditing and Analyzing Logins and Logouts with Functiongraph" class="linkLabel_WmDU">Auditing and Analyzing Logins and Logouts with Functiongraph</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a href="https://docs.otc.t-systems.com/cloud-trace-service/index.html" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0"><span title="ðŸ“š Go to Help Center" class="linkLabel_WmDU">ðŸ“š Go to Help Center</span><svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs-next/pr-preview/pr-336/docs/best-practices/management-and-deployment/log-tank-service"><span title="Log Tank Service" class="categoryLinkLabel_W154">Log Tank Service</span></a><button aria-label="Expand sidebar category &#x27;Log Tank Service&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs-next/pr-preview/pr-336/docs/best-practices/management-and-deployment/resource-formation-service"><span title="Resource Formation Service" class="categoryLinkLabel_W154">Resource Formation Service</span></a><button aria-label="Expand sidebar category &#x27;Resource Formation Service&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs-next/pr-preview/pr-336/docs/best-practices/management-and-deployment/tag-management-service"><span title="Tag Management Service" class="categoryLinkLabel_W154">Tag Management Service</span></a><button aria-label="Expand sidebar category &#x27;Tag Management Service&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs-next/pr-preview/pr-336/docs/best-practices/networking/direct-connect"><span title="Networking" class="categoryLinkLabel_W154">Networking</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs-next/pr-preview/pr-336/docs/best-practices/security-services/anti-ddos"><span title="Security Services" class="categoryLinkLabel_W154">Security Services</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs-next/pr-preview/pr-336/docs/best-practices/storage/cloud-backup-recovery"><span title="Storage" class="categoryLinkLabel_W154">Storage</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs-next/pr-preview/pr-336/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_xK9p"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Management &amp; Deployment</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs-next/pr-preview/pr-336/docs/best-practices/management-and-deployment/cloud-trace"><span itemprop="name">Cloud Trace Service</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Auditing and Analyzing Logins and Logouts with Functiongraph</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Auditing and Analyzing Logins and Logouts with Functiongraph</h1></header>
<p>Cloud Trace Service (CTS) collects real-time records of operations on cloud resources. You can create a CTS trigger to obtain records of subscribed cloud resource operations, analyze and process the operation records, and report alarms. You can use Simple Message Notification (SMN) to push alarm messages to service personnel by SMS message or email. <a href="#figure-1">Figure 1</a> shows the procedure.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="solution-design">Solution Design<a href="#solution-design" class="hash-link" aria-label="Direct link to Solution Design" title="Direct link to Solution Design" translate="no">â€‹</a></h2>
<a id="figure-1"></a>
<p><img decoding="async" loading="lazy" alt="Figure 1" src="/docs-next/pr-preview/pr-336/assets/images/en-us_image_0000001264679162-167335dc9b9138298f172342e243483d.png" width="753" height="460" class="img_ev3q"></p>
<p><strong>Figure 1</strong> Flowchart</p>
<ul>
<li>Operation records collected by CTS can be quickly analyzed and operations from specified IP addresses can be filtered out.</li>
<li>CTS processes and analyzes data in response to log events in a serverless architecture, which features automatic scaling, no O&amp;M, and pay-per-use billing.</li>
<li>CTS sends alarm notifications through SMN.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-cts">Enabling CTS<a href="#enabling-cts" class="hash-link" aria-label="Direct link to Enabling CTS" title="Direct link to Enabling CTS" translate="no">â€‹</a></h2>
<p>Configure a tracker, and the system immediately starts recording operations based on the new rule.</p>
<ol>
<li>Log in to the console.</li>
<li>Click <img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAASCAYAAACEnoQPAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAGkSURBVDiNndO/i+JAGMfhj8eQLFYagkUKbSyEYCysRLCwsFJEwc7av8tCEGJnIfaaSkWxEWzFFCIqGAKJgbviUC5m2Vv2W87MMzPv/Ih5nvebH+bXT+F/8e12+xKL94bdbodlWTiO82pLJpM0m00SiURobOzfmufzOcvlEgBZllEUhcvlgud5ALRaLTKZTBTbto1pmgghaDQaoUGr1YrZbIYQgl6vhyRJ4ZoXiwUAlUrlBZ81F4tFdF0nCALW6/Vr0he+3W4IIcjlcgAMBgP6/T6TyQSAQqEAwPF4jOJnJEnC933u9zsAl8sl1P94PKL44+ODIAiwbRtJkmg2mxiGQbvdBuBwOACgKEoUZ7NZADabDQCaplGtVonH48DfKwTQdT2K8/k8siyz3+85nU6hrW63W87nM6qqomlaFEuSRLlcBmA8HuP7PgCu62JZFgC1Wi00aejADMMgnU7jOA6maeL7PqPRCM/zKJVKpFKpEI69/yrf9xkOh1yvV4QQBEGAqqp0u13e8+lVdTodZFn+En668jOu6zKdTqnX66/n+G38nfwBKbqv10VnRowAAAAASUVORK5CYII=" width="15" height="18" class="img_ev3q"> in the upper left corner of the console and select a region and a project.</li>
<li>Click <img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAXCAYAAAD+4+QTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAABSSURBVEiJY/z///9/BhoDJlpbQDdLWGCM9+8/MKRllTJcvHyNIgP1dbUYZk3rZhAUFICL0cUnjKMRPzItGU3CJIHhE/HDx5LRJEwSGD4RTxdLANA6KyHkPZlqAAAAAElFTkSuQmCC" width="25" height="23" class="img_ev3q"> in the upper left corner and choose <em>Management &amp; Governance</em> -&gt; <em>Cloud Trace Service</em>.</li>
<li>On the displayed page, choose <em>Tracker List</em> in the navigation pane on the left.</li>
<li>Locate a data tracker and click <em>Configure</em> in the <em>Operation</em> column.<!-- -->
<ul>
<li><strong>Operation</strong>: Select the data operations that need to be recorded.</li>
<li><strong>Transfer to OBS</strong>
<ul>
<li>If you select <em>Yes</em>, select an existing OBS bucket or create one directly on the <em>Configure Tracker</em> page and set <strong>File Prefix</strong>.</li>
<li>If you select <em>No</em>, no configuration is required.</li>
</ul>
</li>
<li><strong>Create OBS Bucket</strong>: If this function is enabled, an OBS bucket will be created automatically with the name you enter. If this function is disabled, select an existing OBS bucket.</li>
<li><strong>OBS Bucket</strong>: You can create an OBS bucket or select an existing OBS bucket.</li>
<li><strong>Retention Period</strong>: Select the duration for storing traces in the OBS bucket.</li>
<li><strong>File Prefix</strong>: The prefix is used to mark a transferred trace file. Your specified prefix will be automatically added to the beginning of the name of a transferred file, helping you quickly filter files.</li>
<li><strong>Verify Trace File</strong>: When this function is enabled, integrity verification will be performed to check whether trace files in OBS buckets have been tampered with.</li>
</ul>
</li>
<li>Click <em>OK</em> to complete the tracker configuration.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-an-agency">Creating an Agency<a href="#creating-an-agency" class="hash-link" aria-label="Direct link to Creating an Agency" title="Direct link to Creating an Agency" translate="no">â€‹</a></h2>
<ol>
<li>
<p>Log in to the <a href="https://console.otc.t-systems.com/iam/?locale=en-us" target="_blank" rel="noopener noreferrer"><em>Identity and Access Management (IAM) console</em></a>. In the navigation pane on the left, choose <em>Agencies</em>.</p>
</li>
<li>
<p>On the <em>Agencies</em> page, click <em>Create Agency</em>.</p>
</li>
<li>
<p>Set the agency information.</p>
<ul>
<li>For <strong>Agency Name</strong>, enter <code>serverless\_trust</code>.</li>
<li>For <strong>Agency Type</strong>, select <strong>Cloud service</strong>.</li>
<li>For <strong>Cloud service</strong>, select <strong>FunctionGraph</strong>.</li>
<li>For <strong>Validity Period</strong>, select <strong>Unlimited</strong>.</li>
<li>Click <em>Assign Permissions</em>. On the <em>Assign Permissions</em> page, select <strong>Tenant Administrator</strong>.</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Users with the <strong>Tenant Administrator</strong> permission can perform any operations on all cloud resources of the enterprise.</p></div></div>
</li>
<li>
<p>Click <em>OK</em>.</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pushing-alarm-messages">Pushing Alarm Messages<a href="#pushing-alarm-messages" class="hash-link" aria-label="Direct link to Pushing Alarm Messages" title="Direct link to Pushing Alarm Messages" translate="no">â€‹</a></h2>
<ul>
<li>Create a topic named <code>cts\_test</code> on the <em>SMN console</em>. For details, see <a href="https://docs.otc.t-systems.com/simple-message-notification/umn/topic_management/creating_a_topic.html" target="_blank" rel="noopener noreferrer">Creating a Topic</a>.</li>
<li>Add subscriptions to the <code>cts\_test</code> topic to push alarm messages. For details, see <a href="https://docs.otc.t-systems.com/simple-message-notification/umn/topic_management/adding_a_subscription_to_a_topic.html" target="_blank" rel="noopener noreferrer">Adding a Subscription</a>.</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><ul>
<li>Alarm messages can be sent by <strong>emails</strong>, <strong>SMS</strong> messages, and <strong>HTTP/HTTPS</strong>.</li>
<li>In this example, when log events trigger the specified function, the function filters operations that are performed by users not in the IP address whitelist, and pushes alarm messages to the subscribers.</li>
</ul></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="building-a-program">Building a Program<a href="#building-a-program" class="hash-link" aria-label="Direct link to Building a Program" title="Direct link to Building a Program" translate="no">â€‹</a></h2>
<p>This section describes how use the following snippet for log alarms.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token keyword" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> base64</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> sys</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">handler</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">event</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    text </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">event</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;cts&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    ctsmsg </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">#Resource operator IP</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    source_ip </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> ctsmsg</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;source_ip&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">#trace_name</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    action </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> ctsmsg</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;trace_name&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    SMN_Topic </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">getUserData</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;SMN_Topic&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    regionName </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">getUserData</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;RegionName&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    ip </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">getUserData</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;IP&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    projectId </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">getProjectID</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">action </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">not</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;login&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">or</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;logout&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    	</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;action is fail&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> ip</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">find</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">source_ip</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;reasonable &quot;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> action</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    logInfo </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;  IP:&quot;</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain">source_ip </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;,  Action:&quot;</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain">action</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    body </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;message&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;Illegal operation[&quot;</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain">logInfo</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;]&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;subject&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;CTSTrigger&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    headers </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;X-Auth-Token&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">getToken</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain">  </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;accept&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;application/json&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    url</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;https://smn.&quot;</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain">regionName</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;.otc.t-systems.com/v2/&quot;</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain">projectId</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;/notifications/topics/urn:smn:&quot;</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain">regionName</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;:&quot;</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain">projectId</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;:&quot;</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain">SMN_Topic</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;/publish&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">	</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    response </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">post</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain">headers</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">headers</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain">data</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">json</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">body</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> response</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">status_code </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">200</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">status_code</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;send alarm message failed.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;send email success&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-function">Creating a Function<a href="#creating-a-function" class="hash-link" aria-label="Direct link to Creating a Function" title="Direct link to Creating a Function" translate="no">â€‹</a></h3>
<p>Create a function for extracting the logs (as shown in the Python snippet below) and upload the code package. For details, see <a href="https://docs.otc.t-systems.com/function-graph/umn/function_management.html" target="_blank" rel="noopener noreferrer">Function Management</a>.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token keyword" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> base64</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> sys</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">from</span><span class="token plain"> obs </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">current_file_path </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">dirname</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">os</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">realpath</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">__file__</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 40%)"># append current path to search paths, so that we can import some third party libraries.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">sys</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">current_file_path</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">TEMP_ROOT_PATH </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;/tmp/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">region </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;eu-de&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">secure </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(29, 54%, 61%)">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">signature </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;v4&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">port </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">443</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">path_style </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(29, 54%, 61%)">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">GetObject</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">obsAddr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> bucketName</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> objName</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> ak</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> sk</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    TestObs </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> ObsClient</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">access_key_id</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">ak</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> secret_access_key</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">sk</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                        is_secure</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">secure</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> server</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">obsAddr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> signature</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">signature</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> path_style</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">path_style</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> region</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">region</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                        ssl_verify</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">False</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> port</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">port</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                        max_retry_count</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token number" style="color:hsl(29, 54%, 61%)">5</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> timeout</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token number" style="color:hsl(29, 54%, 61%)">20</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    LobjectRequest </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> GetObjectRequest</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">content_type</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;application/zip&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> content_language</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">None</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> expires</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">None</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                                      cache_control</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">None</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> content_disposition</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">None</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> content_encoding</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">None</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                                      versionId</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">None</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    Lheaders </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> GetObjectHeader</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token builtin" style="color:hsl(95, 38%, 62%)">range</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> if_modified_since</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">None</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> if_unmodified_since</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">None</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> if_match</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">None</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                               if_none_match</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">None</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    loadStreamInMemory </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(29, 54%, 61%)">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    fileNamePath </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> TEMP_ROOT_PATH </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> objName</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    resp </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> TestObs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">getObject</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">bucketName</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">bucketName</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> objectKey</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">objName</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> downloadPath</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">fileNamePath</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             getObjectRequest</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">LobjectRequest</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> headers</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">Lheaders</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> loadStreamInMemory</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">loadStreamInMemory</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;*** GetObject resp: &#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> resp</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token builtin" style="color:hsl(95, 38%, 62%)">int</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">resp</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">status</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">PostObject</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">obsAddr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> bucket</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> objName</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> ak</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> sk</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    obsClient </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> ObsClient</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">access_key_id</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">ak</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> secret_access_key</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">sk</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                        is_secure</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">secure</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> server</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">obsAddr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> signature</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">signature</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> path_style</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">path_style</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> region</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">region</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                        ssl_verify</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">False</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> port</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">port</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                        max_retry_count</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token number" style="color:hsl(29, 54%, 61%)">5</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> timeout</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token number" style="color:hsl(29, 54%, 61%)">20</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    Lheaders </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> PutObjectHeader</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">md5</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">None</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> acl</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;private&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> location</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">None</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> contentType</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;text/plain&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    Lheaders</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">sseHeader </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> SseKmsHeader</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">getInstance</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    h </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> PutObjectHeader</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    Lmetadata </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;key&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;value&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    objPath </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> TEMP_ROOT_PATH </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> objName</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    resp </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> obsClient</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">putFile</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">bucketName</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">bucket</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> objectKey</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">objName</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> file_path</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">objPath</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                              metadata</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">Lmetadata</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> headers</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">h</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(95, 38%, 62%)">isinstance</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">resp</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(95, 38%, 62%)">list</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">for</span><span class="token plain"> k</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> v </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">in</span><span class="token plain"> resp</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;PostObject, objectKey&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> k</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;common msg:status:&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">status</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;,errorCode:&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">errorCode</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;,errorMessage:&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            v</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">errorMessage</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">else</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;*** PostObject, common msg: status:&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> resp</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">status</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;,errorCode:&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> resp</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">errorCode</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;,errorMessage:&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">              resp</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">errorMessage</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">checkAlarmLogs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">logs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    alarmlogs </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">for</span><span class="token plain"> log </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">in</span><span class="token plain"> logs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        logStr </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;WARN&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">in</span><span class="token plain"> logStr </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">or</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;WRN&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">in</span><span class="token plain"> logStr </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">or</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;ERROR&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">in</span><span class="token plain"> logStr </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">or</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;ERR&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">in</span><span class="token plain"> logStr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            alarmlogs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">logStr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> alarmlogs</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">log_store</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">fileName</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> logs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    fileNamePath </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> TEMP_ROOT_PATH </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> fileName</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">with</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(95, 38%, 62%)">open</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">fileNamePath</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;a&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;*** Open log file&quot;</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain">fileNamePath</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot; successfully&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">for</span><span class="token plain"> log </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">in</span><span class="token plain"> logs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            logStr </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">log</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;\\&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;WARN&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">in</span><span class="token plain"> logStr </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">or</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;WRN&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">in</span><span class="token plain"> logStr </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">or</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;ERROR&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">in</span><span class="token plain"> logStr </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">or</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;ERR&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">in</span><span class="token plain"> logStr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                f</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">logStr </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;\n&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> fileName</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">handler</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">event</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)"># Obtains the data of lts logs.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;*********the data of lts logs********&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    encodingData </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;lts&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;data&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    data </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> base64</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">b64decode</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">encodingData</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)"># Base64 decoding is required because the information of lts logs has been encoded.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    text </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)"># Output log group id</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;*** log group id:&quot;</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain">text</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;log_group_id&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)"># Output log topic id</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;*** log topic id:&quot;</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain">text</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;log_topic_id&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)"># Obtains lts log list</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    logs </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> text</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;logs&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)"># Check whether the alarm log existed</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    alarmLogs </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> checkAlarmLogs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">logs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(95, 38%, 62%)">len</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">alarmLogs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;*** no need to send alarm message&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;no need to send alarm message&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)"># send smn message </span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;***********send smn message **********&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    SMN_Topic </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">getUserData</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;SMN_Topic&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">not</span><span class="token plain"> SMN_Topic</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;*** No SMN topic. Please configure &quot;SMN_Topic&quot; environment variable&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;Environment variable configuration error&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    projectId </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">getProjectID</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    body </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;message&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;Get warning message.The content of message is:&quot;</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain">json</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">alarmLogs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;\\&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;subject&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;TimeTrigger&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    headers </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;X-Auth-Token&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">getToken</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain">  </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;accept&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;application/json&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    url</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;https://smn.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> region </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;.otc.t-systems.com/v2/&quot;</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain">projectId</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;/notifications/topics/urn:smn:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> region </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;:&quot;</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain">projectId</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;:&quot;</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain">SMN_Topic</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;/publish&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    response </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">post</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain">headers</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">headers</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain">data</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">json</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">body</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> response</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">status_code </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">200</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;*** send SMN message failed. resp statusCode:&quot;</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token builtin" style="color:hsl(95, 38%, 62%)">str</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">status_code</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;send alarm message failed.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;*** send SMN message to terminal successfully&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;***********strore log file to obs bucket **********&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    obs_address </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">getUserData</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;obs_address&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    storeBucket </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">getUserData</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;obs_store_bucket&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    storeObjName </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">getUserData</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;obs_store_objName&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">not</span><span class="token plain"> obs_address</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">or</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">not</span><span class="token plain"> storeBucket</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">or</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">not</span><span class="token plain"> storeObjName</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;*** No obs environment variable. Please configure obs environment variable&#x27;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;Environment variable configuration error&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    ak </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">getAccessKey</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    sk </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">getSecretKey</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">not</span><span class="token plain"> ak</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">or</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">not</span><span class="token plain"> sk</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;*** Can not get accessKey or secretKey. Please check authority of IAM service&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;accessKey or secretKey error&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;*** obs_address: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> obs_address</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;*** store bucket: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> storeBucket</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;*** store objName: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> storeObjName</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)"># download file uploaded by user from obs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)"># if store object uploaded not exist, automatically create OBS object.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    status </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> GetObject</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">obs_address</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> storeBucket</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> storeObjName</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> ak</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> sk</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> status </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">200</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">print</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;*** get store object failed. Create a new OBS object:&quot;</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain">storeObjName</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    outFile </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> log_store</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">storeObjName</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> alarmLogs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)"># upload file to obs bucket</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    PostObject</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">obs_address</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> storeBucket</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> outFile</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> ak</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> sk</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&#x27;log store success&#x27;</span><br></span></code></pre></div></div>
<p>This function analyzes received operation records, filters logins or logouts from unauthorized IP addresses using a whitelist, and sends alarms under a specified SMN topic.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-environment-variables">Setting Environment Variables<a href="#setting-environment-variables" class="hash-link" aria-label="Direct link to Setting Environment Variables" title="Direct link to Setting Environment Variables" translate="no">â€‹</a></h3>
<p>On the <em>Configuration</em> tab page of the function, set the environment variables and SMN topic name, as shown in table below:</p>
<table><thead><tr><th>Environment Variable</th><th>Description</th></tr></thead><tbody><tr><td>SMN_Topic</td><td>SMN topic name.</td></tr><tr><td>RegionName</td><td>Region.</td></tr><tr><td>IP</td><td>IP address whitelist.</td></tr></tbody></table>
<p><strong>Table 1</strong> Environment variable description</p>
<p>For details about how to set environment variables, see <a href="https://docs.otc.t-systems.com/function-graph/umn/configuring_functions/configuring_environment_variables.html" target="_blank" rel="noopener noreferrer">Using Environment Variables</a>, as shown in <a href="#figure-2">Figure 2</a>.</p>
<a id="figure-2"></a>
<p><img decoding="async" loading="lazy" src="/docs-next/pr-preview/pr-336/assets/images/en-us_image_0000001264392960-9054719e1a3dce557972321447efaadb.png" width="859" height="307" class="img_ev3q"></p>
<p><strong>Figure 2</strong> Setting environment variables</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="adding-an-event-source">Adding an Event Source<a href="#adding-an-event-source" class="hash-link" aria-label="Direct link to Adding an Event Source" title="Direct link to Adding an Event Source" translate="no">â€‹</a></h2>
<p>Create a CTS trigger, as shown in <a href="#enabling-cts">Enabling CTS</a>. For details, see <a href="https://docs.otc.t-systems.com/function-graph/umn/creating_triggers/using_a_cts_trigger.html" target="_blank" rel="noopener noreferrer">Using a CTS Trigger</a>.</p>
<a id="figure-3"></a>
<p><img decoding="async" loading="lazy" src="/docs-next/pr-preview/pr-336/assets/images/en-us_image_0000001312436037-e3255c9a57e3bf03e77905d1bad381f0.png" width="671" height="560" class="img_ev3q"></p>
<p><strong>Figure 3</strong> Creating a CTS trigger</p>
<p>CTS records the logins and logouts of users on IAM.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="processing-operation-records">Processing Operation Records<a href="#processing-operation-records" class="hash-link" aria-label="Direct link to Processing Operation Records" title="Direct link to Processing Operation Records" translate="no">â€‹</a></h2>
<p>When a user performs login or logout using an account, the subscription service log will be triggered and a function will be directly invoked. The system then checks whether the IP address of the current login or logout account is in the whitelist based on function code. If the IP address is not in the whitelist, SMN will send notifications, as shown in <a href="#figure-4">Figure 4</a>.</p>
<a id="figure-4"></a>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUEAAAAvCAIAAADy5e/4AAAGUElEQVR4Ae1c4dGrOBBzLxRDLS6FSiiEOqjFbw7daTRrIAnguThP/LhxnLUsa1e2yffmUvFjBaxAzwqknsmbuxWwAsUedhFYgb4VsIf7zp/ZWwF72DVgBfpWwB7uO39mbwXsYdeAFehbAXu47/yZvRWwh10DVqBvBezhvvNn9lbAHnYNWIG+FbCH+86f2VsBe9g1YAX6VsAe7jt/Zm8F7GHXgBXoWwF7uO/8mb0VsIddA1agbwXs4b7zZ/ZW4AMPD8Mwz3MphY378j0IdZ/MZYScc9qeywge+FUKtCjLeZ5RJMuyPLvYFx4ex3GaJkzJhbFxn8qDUBfI5O3hwJQSF8vOdxo55/OBKuM4jshlSmkYhiP8ZVlSSuM4agAHhn7GsFBSSjnnUopOl1KqC+gooIbiLGjUDHUIBUEYmINSwDn6iJ2xJhzi8/aw83ISiXD5lHpn6t0U6NQX2vbwP4V+8/nUw6zvcXvq2dE/TZN6dRgGekDbHA4L8SMaun2Er04CdqF0+C7DlP4tJwxftyelhOtbKUXbirbbxjbEJe/GlFLy9hx9e62/3dHyjR7myaBa637MA2FdVwYzqbtiDcPASOZgGAbd0dd15VcMVg5AxlellHp2PX8wUMkccdClkcBlD2NFwMk5h2NZPayRpZRdj0EiskLjmod3oQJyKUUZhm9RrPM866JO4sPweZ7HcQyrRgzTjRh+vJ9EUn1ZCVoGrHCO0trjvkbyL28WQYqXH2+dw8Mw8EjhAuAWEM058yThYrT+OIpE9YTRsoapYN3QX3PAdYgz4gTAFDp73h6dmi/83A7CXMQcx1FjyIFo2lAjaVtrVCfCWK34YAYM1I0MsuvWg2/rrUqJhcs2VnQEFQaeeHiaJvgBPFm1YRU1IHuoUqiQUHL1Ocz480LCRCGJtYd3QY4qXKferRPUIdXgYm82rntY60/Tqf27OYMEqDAuG8vQsTw860gihHgt+oBMmTj2KP0BU+MVE4cAYC+fw1oiZMiGLicoqawQjx7WR70jIOBkr2HAS6hdhqUUSMe7D8KmaeJRef4TAGFBAHlXEUJqEJ+3h2ORoxCpgEdJJALfh49AtF/zQmQ2cGPiMfalHtb0gKtWgJ7D4fpROxNFwL0QmvL9QXWBFuu6Qs2aA9PAxOzOnreHMZhiWZZ3OGjyPvUwCfMkJwdtaPnqdHQLNMQQLVMGKBr2LK2n8C0D3oHCWGWoaECo94ujeB2r5wEXgr2pTs3JRvxpEpXDeSUcVThLlA14WJmwnnW6m+3HzmHywApZpuiH2VBzWiK6WiYsQNVuJ4LuiByFhiIfzZ63hwMxJGByrrAvqKk+9XBd3OSgDa34wEpn5xCtjxCPmLw9jK8bDHgJhbHKMKARSvv1Jqz9oa1vBCgkbHbvLOpyEpXDOchuhWt5aO2FTKmwOuOd9nUPg3RdjnrJJDNVH5er2pkI1uulHuPIK2JCf81BBQ1bg84eSpDSn3Dgr3Gam0c8XN9+Az390wXNoFT1V2686S3LwqMeKcCBxlFHATUUJCUaEqEMl2XRQ17ZMmt8S9QM4lv+Fzz1ioGUIUBhcb4pB80718j7BRCY5XBIqv6M2QXZrfAw9W6dfN1dmpryyKWX9HcUXiT4DyHQOPIw1glMrQlULediyjU+JJg6Iovc0VNKmJ0bKpgzc4oZOBCzqYdVQP6VmGz5Q2jtK+pD2nqm8W1ZS3M3YFcBHbXLUDshqXKmgfFDWtgOmNC8PfxY/vubApRXQCyHPfeTyFp9WQm60nqUDtc6garMgq7xTvvFOXwBOuyL/IHxApQOUV20/xvaL8/hbyD5PRzgOj1pv4fbO0zuVPj/cJd+Z0khJm8PO5/y3lM4JPZgg1eMBzF/GKr3LS9vDxP0ZmXyV9UOzmFc8Hip4wWba77WeFOpa+AeZQU+UkBfQJ6q8I8IaPDzd2lFd9sKWIHWCtjDrRU2vhVoq4A93FZfo1uB1grYw60VNr4VaKuAPdxWX6NbgdYK2MOtFTa+FWirgD3cVl+jW4HWCtjDrRU2vhVoq4A93FZfo1uB1grYw60VNr4VaKuAPdxWX6NbgdYKnHlY/y8q67q2+9h6kca3Aj+swJmHf3jZXpoV+BkF7OGfSaUX8pcqYA//pYn3sn9GAXv4Z1LphfylCvwBLze/TwuTVUAAAAAASUVORK5CYII=" width="321" height="47" class="img_ev3q"></p>
<p><strong>Figure 4</strong> Alarm notification sent by email</p>
<p>The email contains the unauthorized IP address and user operation (login or logout).</p>
<p>On the <em>Monitoring</em> tab page of the function, check the number of invocations, as shown in <a href="#figure-5">Figure 5</a>.</p>
<a id="figure-"></a>
<p><strong>Figure 5</strong> Function metrics<br>
<img decoding="async" loading="lazy" src="/docs-next/pr-preview/pr-336/assets/images/en-us_image_0000002169007081-ae4d6d9f903d4c0f79dcecca38d0ae45.png" width="1875" height="617" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs-next/pr-preview/pr-336/docs/tags/cts">cts</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs-next/pr-preview/pr-336/docs/tags/cts-trigger">cts-trigger</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs-next/pr-preview/pr-336/docs/tags/functiongraph">functiongraph</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs-next/pr-preview/pr-336/docs/tags/events">events</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/docs-next/pr-preview/pr-336/docs/tags/logs">logs</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/opentelekomcloud/docs-next/tree/main/docs/best-practices/management-and-deployment/cloud-trace/auditing-and-analyzing-logins-and-logouts-with-functiongraph.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs-next/pr-preview/pr-336/docs/best-practices/management-and-deployment/cloud-trace"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Cloud Trace Service</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs-next/pr-preview/pr-336/docs/best-practices/management-and-deployment/log-tank-service"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Log Tank Service</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#solution-design" class="table-of-contents__link toc-highlight">Solution Design</a></li><li><a href="#enabling-cts" class="table-of-contents__link toc-highlight">Enabling CTS</a></li><li><a href="#creating-an-agency" class="table-of-contents__link toc-highlight">Creating an Agency</a></li><li><a href="#pushing-alarm-messages" class="table-of-contents__link toc-highlight">Pushing Alarm Messages</a></li><li><a href="#building-a-program" class="table-of-contents__link toc-highlight">Building a Program</a><ul><li><a href="#creating-a-function" class="table-of-contents__link toc-highlight">Creating a Function</a></li><li><a href="#setting-environment-variables" class="table-of-contents__link toc-highlight">Setting Environment Variables</a></li></ul></li><li><a href="#adding-an-event-source" class="table-of-contents__link toc-highlight">Adding an Event Source</a></li><li><a href="#processing-operation-records" class="table-of-contents__link toc-highlight">Processing Operation Records</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="align-items-center" style="margin:0 0 0 32px"><div class="col-10 text-right"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.otc.t-systems.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Help Center</a></li><li class="footer__item"><a class="footer__link-item" href="/docs-next/pr-preview/pr-336/portfolio">Portfolio Navigator</a></li><li class="footer__item"><a href="https://www.open-telekom-cloud.com/en/products-services/roadmap" target="_blank" rel="noopener noreferrer" class="footer__link-item">Portfolio Roadmap</a></li><li class="footer__item"><a href="https://www.open-telekom-cloud.com/en/support/release-notes" target="_blank" rel="noopener noreferrer" class="footer__link-item">Release Notes</a></li><li class="footer__item"><a href="https://www.open-telekom-cloud.com/en/products-services/core-services/certifications" target="_blank" rel="noopener noreferrer" class="footer__link-item">Core Services Certifications</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://marketplace.otc.t-systems.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Marketplace</a></li><li class="footer__item"><a href="https://community.open-telekom-cloud.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community Portal</a></li><li class="footer__item"><a href="https://www.youtube.com/playlist?list=PLS60dhorR-hgQ5n5L1boEQh0oVD-_k75p" target="_blank" rel="noopener noreferrer" class="footer__link-item">Webinars in YouTube<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Developers</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.otc.t-systems.com/developer/sdk.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">SDKs</a></li><li class="footer__item"><a href="https://docs.otc.t-systems.com/developer/drivers.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Drivers &amp; Tools</a></li><li class="footer__item"><a href="https://registry.terraform.io/providers/opentelekomcloud/opentelekomcloud/latest/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terraform Provider<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://docs.otc.t-systems.com/ansible-collection-cloud/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ansible Collections</a></li><li class="footer__item"><a href="https://designer.otc-service.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cloud Create</a></li></ul></div><div class="col footer__col"><div class="footer__title">API</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.otc.t-systems.com/developer/api.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">REST API</a></li><li class="footer__item"><a href="https://docs.otc.t-systems.com/developer/api_guidelines/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">REST API Usage Guidelines</a></li><li class="footer__item"><a href="https://docs.otc.t-systems.com/regions-and-endpoints/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Regions &amp; Endpoints</a></li></ul></div><div class="col footer__col"><div class="footer__title">Tools</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://enterprise-dashboard.otc-service.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Enterprise Dashboard</a></li><li class="footer__item"><a href="https://www.open-telekom-cloud.com/en/prices/price-calculator" target="_blank" rel="noopener noreferrer" class="footer__link-item">Price Calculator</a></li><li class="footer__item"><a href="https://status.otc-service.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Status Dashboard</a></li></ul></div></div></div></div></div><scale-telekom-footer type="minimal"><scale-telekom-footer-content><span slot="notice">Â© T-Systems International GmbH 2025<!-- --> <scale-tag size="small" style="margin:0 0 0 8px" color="orange" type="strong">0.1.PR336-246-3804652-ephemeral</scale-tag></span><ul slot="navigation"><li><a href="https://open-telekom-cloud.com/en/contact"> Contact </a></li><li><a href="https://open-telekom-cloud.com/en/data-protection"> Data privacy </a></li><li><a href="https://open-telekom-cloud.com/en/disclaimer-of-liability"> Disclaimer of liabilities </a></li><li><a href="https://open-telekom-cloud.com/en/imprint"> Imprint </a></li></ul></scale-telekom-footer-content></scale-telekom-footer></footer></div>
</body>
</html>