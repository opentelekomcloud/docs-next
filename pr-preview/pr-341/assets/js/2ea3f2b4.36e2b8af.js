"use strict";(self.webpackChunkdocs_next=self.webpackChunkdocs_next||[]).push([[21826],{61543:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"blueprints/by-use-case/security/microsoft/active-directory-as-identity-provider-iam","title":"Active Directory as Identity Provider for IAM","description":"In this guide, we\'ll walk you through extending your on\u2011premises Microsoft Active Directory Domain Services (AD\xa0DS) and Active Directory Federation Services (AD\xa0FS) in order to establish a secure, claims\u2011based federation with Open\xa0Telekom\xa0Cloud\'s Identity and Access Management (IAM) platform. We are going to leverage the SAML\xa02.0 protocol to achieve seamless single\u2011sign\u2011on between your on-premises corporate directory and the Open Telekom Cloud IAM, ensuring both strong security and a smooth user experience.","source":"@site/docs/blueprints/by-use-case/security/microsoft/active-directory-as-identity-provider-iam.md","sourceDirName":"blueprints/by-use-case/security/microsoft","slug":"/blueprints/by-use-case/security/microsoft/active-directory-as-identity-provider-iam","permalink":"/docs-next/pr-preview/pr-341/docs/blueprints/by-use-case/security/microsoft/active-directory-as-identity-provider-iam","draft":false,"unlisted":false,"editUrl":"https://github.com/opentelekomcloud/docs-next/tree/main/docs/blueprints/by-use-case/security/microsoft/active-directory-as-identity-provider-iam.md","tags":[{"inline":true,"label":"security","permalink":"/docs-next/pr-preview/pr-341/docs/tags/security"},{"inline":true,"label":"saml","permalink":"/docs-next/pr-preview/pr-341/docs/tags/saml"},{"inline":true,"label":"iam","permalink":"/docs-next/pr-preview/pr-341/docs/tags/iam"},{"inline":true,"label":"active-directory","permalink":"/docs-next/pr-preview/pr-341/docs/tags/active-directory"},{"inline":true,"label":"ldap","permalink":"/docs-next/pr-preview/pr-341/docs/tags/ldap"},{"inline":true,"label":"adfs","permalink":"/docs-next/pr-preview/pr-341/docs/tags/adfs"},{"inline":true,"label":"microsoft","permalink":"/docs-next/pr-preview/pr-341/docs/tags/microsoft"}],"version":"current","frontMatter":{"id":"active-directory-as-identity-provider-iam","title":"Active Directory as Identity Provider for IAM","tags":["security","saml","iam","active-directory","ldap","adfs","microsoft"]},"sidebar":"blueprintsSidebar","previous":{"title":"Microsoft","permalink":"/docs-next/pr-preview/pr-341/docs/blueprints/by-use-case/security/microsoft/microsoft"},"next":{"title":"Azure Entra ID as Identity Provider for IAM","permalink":"/docs-next/pr-preview/pr-341/docs/blueprints/by-use-case/security/microsoft/azure-entraid-as-identity-provider-iam"}}');var r=n(74848),t=n(28453);const o={id:"active-directory-as-identity-provider-iam",title:"Active Directory as Identity Provider for IAM",tags:["security","saml","iam","active-directory","ldap","adfs","microsoft"]},l="Active Directory as Identity Provider for IAM",a={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Creating a new Relying Party Trust in AD FS",id:"creating-a-new-relying-party-trust-in-ad-fs",level:2},{value:"Setting the Secure Hash Algorithm",id:"setting-the-secure-hash-algorithm",level:3},{value:"Editing Claim Issuance Policy",id:"editing-claim-issuance-policy",level:2},{value:"Configuring IAM",id:"configuring-iam",level:2},{value:"Creating a new Identity Provider",id:"creating-a-new-identity-provider",level:3},{value:"Configure the new Identity Provider",id:"configure-the-new-identity-provider",level:3},{value:"Configure the Conversion Rules",id:"configure-the-conversion-rules",level:3},{value:"Verification",id:"verification",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"MSIS7093: The message is not signed with expected signature algorithm",id:"msis7093-the-message-is-not-signed-with-expected-signature-algorithm",level:3}];function d(e){const i={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"active-directory-as-identity-provider-for-iam",children:"Active Directory as Identity Provider for IAM"})}),"\n",(0,r.jsx)(i.p,{children:"In this guide, we'll walk you through extending your on\u2011premises Microsoft Active Directory Domain Services (AD\xa0DS) and Active Directory Federation Services (AD\xa0FS) in order to establish a secure, claims\u2011based federation with Open\xa0Telekom\xa0Cloud's Identity and Access Management (IAM) platform. We are going to leverage the SAML\xa02.0 protocol to achieve seamless single\u2011sign\u2011on between your on-premises corporate directory and the Open Telekom Cloud IAM, ensuring both strong security and a smooth user experience."}),"\n",(0,r.jsx)(i.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(i.p,{children:"Before initiating the integration process, make sure the following prerequisites are met:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["A fully deployed and accessible ADFS instance, reachable via a valid public domain. If an instance is not already available, you may create one by following the ",(0,r.jsx)(i.a,{href:"/docs-next/pr-preview/pr-341/docs/blueprints/by-use-case/security/microsoft/deploy-active-directory-federation-services-on-ecs",children:"Deploy Active Directory Federation Services on ECS"})," guide."]}),"\n",(0,r.jsx)(i.li,{children:"Administrator-level access to both Microsoft ADFS and Open Telekom Cloud's Identity and Access Management (IAM) console."}),"\n",(0,r.jsx)(i.li,{children:"A working knowledge of SAML 2.0, particularly around concepts such as assertions, metadata exchange, and service provider (SP) vs. identity provider (IdP) roles. If needed, refer to the SAML 2.0 specification for a foundational overview.\nThese requirements ensure that you're equipped to configure and validate the trust relationship between the two platforms."}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"creating-a-new-relying-party-trust-in-ad-fs",children:"Creating a new Relying Party Trust in AD FS"}),"\n",(0,r.jsx)(i.p,{children:"First, retrieve the Service Provider metadata for Open\xa0Telekom\xa0Cloud:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["Launch your web browser and navigate to:",(0,r.jsx)(i.br,{}),"\n",(0,r.jsx)(i.code,{children:"https://auth.otc.t-systems.com/authui/saml/metadata.xml"})]}),"\n",(0,r.jsxs)(i.li,{children:["When the XML metadata loads, save the document locally under the filename ",(0,r.jsx)(i.strong,{children:"sp-metadata.xml"}),"."]}),"\n",(0,r.jsxs)(i.li,{children:["Confirm that ",(0,r.jsx)(i.strong,{children:"sp-metadata.xml"})," is intact\u2014its root element should be ",(0,r.jsx)(i.code,{children:"<EntityDescriptor>"}),"\u2014before proceeding."]}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"You'll reference this file when establishing the Relying Party Trust in AD\xa0FS."}),"\n",(0,r.jsxs)(i.p,{children:["Then, go to ",(0,r.jsx)(i.em,{children:"Server Manager"})," -> ",(0,r.jsx)(i.em,{children:"Tools"})," -> ",(0,r.jsx)(i.em,{children:"AD FS Management"})," -> ",(0,r.jsx)(i.em,{children:"Relying Party Trusts"})," -> ",(0,r.jsx)(i.em,{children:"Add Relying Party Trust"})]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"image",src:n(49780).A+"",width:"1871",height:"848"})}),"\n",(0,r.jsx)(i.p,{children:"Follow the wizard:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Welcome"}),': Choose "',(0,r.jsx)(i.em,{children:"Claims-aware"}),'" and click ',(0,r.jsx)(i.em,{children:"Next"}),"."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Select Data Source"}),': Choose "',(0,r.jsx)(i.em,{children:"Import data about the relying party from a file"}),'" and click ',(0,r.jsx)(i.em,{children:"Browse"})," and pick ",(0,r.jsx)(i.strong,{children:"sp-metadata.xml"}),". Click ",(0,r.jsx)(i.em,{children:"Next"}),"."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Specify Display Name"}),": Enter ",(0,r.jsx)(i.strong,{children:"Open Telekom Cloud"})," and click ",(0,r.jsx)(i.em,{children:"Next"}),"."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Choose Access Control Policy"}),': Choose "',(0,r.jsx)(i.em,{children:"Permit everyone"}),'" and click ',(0,r.jsx)(i.em,{children:"Next"}),"."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Ready to Add Trust"}),": Click ",(0,r.jsx)(i.em,{children:"Next"}),"."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Finish"}),': Deselect "',(0,r.jsx)(i.em,{children:"Configure claims issuance policy for this application"}),'" and click ',(0,r.jsx)(i.em,{children:"Close"}),"."]}),"\n"]}),"\n",(0,r.jsx)(i.admonition,{type:"danger",children:(0,r.jsxs)(i.p,{children:["In Step\xa04 of the Relying Party Trust configuration, you'll specify the Access Control Policy that governs who can authenticate via this trust. For the purposes of this blueprint we've selected the built\u2011in \"",(0,r.jsx)(i.em,{children:"Permit everyone"}),"\" policy to streamline testing and validation. In your environment, however, you should work closely with your security and platform architects to choose a policy that enforces the appropriate controls (for example, requiring MFA, restricting by AD group membership, or integrating with Conditional Access rules) in accordance with your organization's security guidelines."]})}),"\n",(0,r.jsx)(i.h3,{id:"setting-the-secure-hash-algorithm",children:"Setting the Secure Hash Algorithm"}),"\n",(0,r.jsxs)(i.p,{children:["Finally, we need to set the secure hash algorith to ",(0,r.jsx)(i.code,{children:"RSA-SHA1"}),". Go to ",(0,r.jsx)(i.em,{children:"Server Manager"})," -> ",(0,r.jsx)(i.em,{children:"Tools"})," -> ",(0,r.jsx)(i.em,{children:"AD FS Management"})," -> ",(0,r.jsx)(i.em,{children:"Relying Party Trusts"}),", right-click on ",(0,r.jsx)(i.strong,{children:"Open Telekom Cloud"}),", click ",(0,r.jsx)(i.em,{children:"Properties"})," and go to tab ",(0,r.jsx)(i.em,{children:"Advanced"}),":"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"alt text",src:n(48212).A+"",width:"1818",height:"756"})}),"\n",(0,r.jsx)(i.h2,{id:"editing-claim-issuance-policy",children:"Editing Claim Issuance Policy"}),"\n",(0,r.jsxs)(i.p,{children:["Next, let's configure the Claims Issuance Policy so that AD\xa0FS will emit the correct SAML assertions to Open\xa0Telekom\xa0Cloud. go to ",(0,r.jsx)(i.em,{children:"Server Manager"})," -> ",(0,r.jsx)(i.em,{children:"Tools"})," -> ",(0,r.jsx)(i.em,{children:"AD FS Management"})," -> ",(0,r.jsx)(i.em,{children:"Relying Party Trusts"}),", right-click on ",(0,r.jsx)(i.strong,{children:"Open Telekom Cloud"})," and click ",(0,r.jsx)(i.em,{children:"Edit Claim Issuance Policy"}),":"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"image",src:n(52985).A+"",width:"1875",height:"824"})}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Rule 01"}),": Click on ",(0,r.jsx)(i.em,{children:"Add Rule"}),":"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Claim rule template"}),': "',(0,r.jsx)(i.em,{children:"Send Claims using a Custom Rule"}),'"']}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Claim rule name"}),": ",(0,r.jsx)(i.em,{children:"nameidentifier_custom_rule"})]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Custom rule"}),":"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-title",metastring:'"Custom rule"',children:'c:[Type == "http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname", Issuer == "AD AUTHORITY"] => add(store = "Active Directory", types = ("http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier"), query = ";sAMAccountName;{0}", param = c.Value);\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Rule 02"}),": Click on ",(0,r.jsx)(i.em,{children:"Add Rule"}),":"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Claim rule template"}),': "',(0,r.jsx)(i.em,{children:"Send Claims using a Custom Rule"}),'"']}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Claim rule name"}),": ",(0,r.jsx)(i.em,{children:"transient_nameidentifier_custom_rule"})]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Custom rule"}),":"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-title",metastring:'"Custom rule"',children:'c:[Type == "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier"] => issue(Type = "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier", Issuer = c.Issuer, OriginalIssuer = c.OriginalIssuer, Value = c.Value, ValueType = c.ValueType, Properties["http://schemas.xmlsoap.org/ws/2005/05/identity/claimproperties/format"] = "urn:oasis:names:tc:SAML:2.0:nameid-format:transient", Properties["http://schemas.xmlsoap.org/ws/2005/05/identity/claimproperties/spnamequalifier"] = "https://auth.otc.t-systems.com");\n'})}),"\n",(0,r.jsx)(i.admonition,{type:"warning",children:(0,r.jsxs)(i.p,{children:["Be extra cautious in case of entering ",(0,r.jsx)(i.code,{children:"spnamequalifier"})," manually; there should be ",(0,r.jsx)(i.strong,{children:"no trailing slash"})," in the end of the URL otherwise it will be considered as a different Relying Party."]})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Rule 03"}),": Click on ",(0,r.jsx)(i.em,{children:"Add Rule"}),":"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Claim rule template"}),': "',(0,r.jsx)(i.em,{children:"Send Group Membership as Claim"}),'"']}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Claim rule name"}),": ",(0,r.jsx)(i.em,{children:"tenant_admins_group_membership_rule"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"User's Group"}),": ",(0,r.jsx)(i.em,{children:"MYCOMPANY\\Tenant-Admins"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Outgoing claim type"}),': "',(0,r.jsx)(i.em,{children:"Group"}),'"']}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Outgoing claim value"}),": ",(0,r.jsx)(i.em,{children:"Tenant-Admins"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Rule 04"}),": Click on ",(0,r.jsx)(i.em,{children:"Add Rule"}),":"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Claim rule template"}),': "',(0,r.jsx)(i.em,{children:"Send Group Membership as Claim"}),'"']}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Claim rule name"}),": ",(0,r.jsx)(i.em,{children:"ecs_admins_group_membership_rule"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"User's Group"}),": ",(0,r.jsx)(i.em,{children:"MYCOMPANY\\ECS-Admins"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Outgoing claim type"}),': "',(0,r.jsx)(i.em,{children:"Group"}),'"']}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Outgoing claim value"}),": ",(0,r.jsx)(i.em,{children:"ECS-Admins"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.admonition,{type:"important",children:(0,r.jsxs)(i.p,{children:["This blueprint assumes you have the following groups in Active Directory : ",(0,r.jsx)(i.code,{children:"Tenant-Admins"})," and ",(0,r.jsx)(i.code,{children:"ECS-Admins"}),". Adjust the settings in steps\xa03 &\xa04 according to your AD users and groups."]})}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Rule 05"}),": Click on ",(0,r.jsx)(i.em,{children:"Add Rule"}),":","\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Claim rule template"}),': "',(0,r.jsx)(i.em,{children:"Send LDAP Attributes as Claims"}),'"']}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Claim rule name"}),": ",(0,r.jsx)(i.em,{children:"ldap_attributes_rule"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Attribute store"}),': "',(0,r.jsx)(i.em,{children:"Active Directory"}),'"']}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:["Fill in the ",(0,r.jsx)(i.em,{children:"Mapping of LDAP attributes to outgoing claim types"})," as depicted in the picture below:"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"image",src:n(87994).A+"",width:"1871",height:"848"})}),"\n",(0,r.jsx)(i.h2,{id:"configuring-iam",children:"Configuring IAM"}),"\n",(0,r.jsx)(i.h3,{id:"creating-a-new-identity-provider",children:"Creating a new Identity Provider"}),"\n",(0,r.jsxs)(i.p,{children:["Go to ",(0,r.jsx)(i.em,{children:"Open Telekom Cloud Console"})," -> ",(0,r.jsx)(i.em,{children:"IAM"})," -> ",(0,r.jsx)(i.em,{children:"Identity Providers"})," and click ",(0,r.jsx)(i.em,{children:"Create Identity Provider"}),":"]}),"\n",(0,r.jsxs)(i.p,{children:["Set the following parameters and click ",(0,r.jsx)(i.em,{children:"OK"}),"."]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Protocol"}),": ",(0,r.jsx)(i.code,{children:"SAML"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"SSO Type"}),": ",(0,r.jsx)(i.code,{children:"Virtual user"})]}),"\n"]}),"\n",(0,r.jsx)(i.admonition,{type:"note",children:(0,r.jsxs)(i.p,{children:["Choosing Virtual user allows OTC to create ephemeral user sessions based on SAML assertions without requiring persistent user accounts in IAM. This mode is suitable for scenarios where user identity and group memberships are fully managed by the external IdP (in this case AD/AD FS). For more information about Virtual Users check the ",(0,r.jsx)(i.a,{href:"https://docs.otc.t-systems.com/identity-access-management/umn/user_guide/identity_providers/virtual_user_sso_via_saml/overview_of_virtual_user_sso_via_saml.html#iam-08-0021",children:"documentation"})," in our Help Center."]})}),"\n",(0,r.jsx)(i.h3,{id:"configure-the-new-identity-provider",children:"Configure the new Identity Provider"}),"\n",(0,r.jsx)(i.p,{children:"First, retrieve the ADFS federation metadata:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["Launch your web browser and navigate to:",(0,r.jsx)(i.br,{}),"\n",(0,r.jsx)(i.code,{children:"https://adfs.example.com/federationmetadata/2007-06/federationmetadata.xml"})]}),"\n",(0,r.jsxs)(i.li,{children:["When the XML metadata loads, save the document locally under the filename ",(0,r.jsx)(i.strong,{children:"idp-metadata.xml"}),"."]}),"\n"]}),"\n",(0,r.jsx)(i.admonition,{type:"important",children:(0,r.jsxs)(i.p,{children:["Replace ",(0,r.jsx)(i.code,{children:"example.com"})," with the public domain named of your organization."]})}),"\n",(0,r.jsxs)(i.p,{children:["After your AD FS infrastructure and Relying Party configuration is in place correctly injecting the necessary assertions and the Open Telekom Cloud Identity Provider has been created, navigate to the ",(0,r.jsx)(i.em,{children:"Identity Providers"})," and click on ",(0,r.jsx)(i.em,{children:"Modify"})," next to the provider to finalize the trust relationship by uploading AD FS's metadata to Open Telekom Cloud IAM. Under the ",(0,r.jsx)(i.em,{children:"Metadata Configuration"})," section click ",(0,r.jsx)(i.em,{children:"Upload"})," and select the ",(0,r.jsx)(i.strong,{children:"idp-metadata.xml"})," file you retrieved earlier."]}),"\n",(0,r.jsx)(i.p,{children:"This file contains AD FS SAML configuration, including its public keys and SSO endpoints. Uploading it allows Open Telekom Cloud IAM to trust and process incoming authentication responses from AD FS securely, based on signed and validated assertions. Once uploaded, save the configuration to apply the changes."}),"\n",(0,r.jsx)(i.h3,{id:"configure-the-conversion-rules",children:"Configure the Conversion Rules"}),"\n",(0,r.jsx)(i.p,{children:"Now that the metadata exchange is complete and AD FS is trusted by Open Telekom Cloud IAM, the next step is to define conversion rules. These rules map incoming SAML attributes, such as LDAP groups to IAM user groups within your Open Telekom Cloud tenant. This mapping is essential for authorization. It ensures that users federated through AD FS are granted the correct level of access in OTC based on the attributes included in the SAML assertions."}),"\n",(0,r.jsxs)(i.p,{children:["Return to the ",(0,r.jsx)(i.em,{children:"IAM"})," -> ",(0,r.jsx)(i.em,{children:"Identity Providers"})," section in the ",(0,r.jsx)(i.em,{children:"Open Telekom Cloud IAM Console"}),", locate your configured AD FS SAML provider, and click ",(0,r.jsx)(i.em,{children:"Modify"}),". Scroll to the bottom of the configuration page and click on the ",(0,r.jsx)(i.em,{children:"Edit Rule"})," link under ",(0,r.jsx)(i.em,{children:"Identity Conversion Rules"}),". This will open the rule editor where you can define how SAML attributes from AD FS are translated into Open Telekom Cloud IAM group memberships."]}),"\n",(0,r.jsxs)(i.p,{children:["In the ",(0,r.jsx)(i.em,{children:"Edit Rule"})," popup, remove the default rule and paste the following conversion logic. This rule maps users from AD FS to the appropriate Open Telekom Cloud IAM group(s) based on the Active Directory Group they belong to and was included as an attribute in the SAML assertions:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",metastring:'title="Identity Conversion Rule"',children:'[\n  {\n    "remote": [\n      {\n        "type": "http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname"\n      },\n      {\n        "any_one_of": [ "Tenant-Admins"],\n        "type": "http://schemas.xmlsoap.org/claims/Group"\n      }\n    ],\n    "local": [\n      {\n        "user": { "name": "{0}@mycompany.com" }\n      },\n      {\n        "group": { "name": "admin" }\n      }\n    ]\n  },\n  {\n    "remote": [\n      {\n        "type": "http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname"\n      },\n      {\n        "any_one_of": [ "ECS-Admins" ],\n        "type": "http://schemas.xmlsoap.org/claims/Group"\n      }\n    ],\n    "local": [\n      {\n        "user": { "name": "{0}@mycompany.com" }\n      },\n      {\n        "group": { "name": "ecs-admin" }\n      }\n    ]\n  }\n]\n'})}),"\n",(0,r.jsxs)(i.p,{children:["It will construct a federated username in the format: ",(0,r.jsx)(i.code,{children:"{windowsaccountname}@mycompany.com"})]}),"\n",(0,r.jsxs)(i.admonition,{type:"important",children:[(0,r.jsx)(i.p,{children:"This blueprint operates under the assumption that your Open Telekom Cloud IAM environment includes the following two User Groups:"}),(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Group"}),(0,r.jsx)(i.th,{children:"Policy/Role"}),(0,r.jsx)(i.th,{children:"Description"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.strong,{children:"rds-admin"})}),(0,r.jsx)(i.td,{children:"Tenant Guest"}),(0,r.jsx)(i.td,{children:"Tenant Guest (Exclude IAM)"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{}),(0,r.jsx)(i.td,{children:"RDS Administrator"}),(0,r.jsx)(i.td,{children:"RDS Administrator"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{}),(0,r.jsx)(i.td,{children:"Server Administrator"}),(0,r.jsx)(i.td,{children:"Server Administrator"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.strong,{children:"ecs-admin"})}),(0,r.jsx)(i.td,{children:"ECS Admin"}),(0,r.jsx)(i.td,{children:"All permissions of ECS service."})]})]})]})]}),"\n",(0,r.jsx)(i.h2,{id:"verification",children:"Verification"}),"\n",(0,r.jsxs)(i.p,{children:["Return to the ",(0,r.jsx)(i.em,{children:"IAM"})," -> ",(0,r.jsx)(i.em,{children:"Identity Providers"})," section in the ",(0,r.jsx)(i.em,{children:"Open Telekom Cloud IAM Console"}),", locate your configured AD FS SAML provider, Then click ",(0,r.jsx)(i.em,{children:"View"})," next to your configured Identity Provider. In the details panel, locate the ",(0,r.jsx)(i.em,{children:"Login Link"}),", copy its value, and open it in an incognito or private browsing session using your preferred browser:"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"alt text",src:n(9536).A+"",width:"1843",height:"873"})}),"\n",(0,r.jsxs)(i.p,{children:["Enter your corporate credentials for a user who is a member of ",(0,r.jsx)(i.code,{children:"MYCOMPANY\\ECS-Admins"})," and verify that he is operating with reduced priviledges in Open Telekom Cloud Console:"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"alt text",src:n(35227).A+"",width:"1893",height:"869"})}),"\n",(0,r.jsx)(i.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(i.h3,{id:"msis7093-the-message-is-not-signed-with-expected-signature-algorithm",children:"MSIS7093: The message is not signed with expected signature algorithm"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Encountered error during federation passive request. \n\nAdditional Data \n\nProtocol Name: \nSaml \n\nRelying Party: \nhttps://auth.otc.t-systems.com \n\nException details: \nMicrosoft.IdentityServer.Protocols.Saml.SamlProtocolSignatureAlgorithmMismatchException: MSIS7093: The message is not signed with expected signature algorithm. Message is signed with signature algorithm http://www.w3.org/2000/09/xmldsig#rsa-sha1. Expected signature algorithm http://www.w3.org/2001/04/xmldsig-more#rsa-sha256.\n"})}),"\n",(0,r.jsxs)(i.p,{children:["That exception is informing us that AD FS will ",(0,r.jsx)(i.strong,{children:"only"})," accept SAML messages signed with the algorithm it's been configured to expect\u2014and in this case it was configured for ",(0,r.jsx)(i.code,{children:"RSA\u2011SHA256"}),", but the Service Provider (Open Telekom Cloud) is signing everything with ",(0,r.jsx)(i.code,{children:"RSA\u2011SHA1"}),". In order to solve this error refer to ",(0,r.jsx)(i.a,{href:"#setting-the-secure-hash-algorithm",children:"Setting the Secure Hash Algorithm"}),"."]})]})}function h(e={}){const{wrapper:i}={...(0,t.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},52985:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/Screenshot_from_2025-04-21_14-23-32-e1519d94031eaf81c27356b7bc357d55.png"},49780:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/Screenshot_from_2025-04-22_09-34-05-a66a8cd85c28d8ddbea9a316dfb00d31.png"},87994:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/Screenshot_from_2025-04-22_10-59-39-c6dc8c28b7eae7092bdf2bf3f8ff79e5.png"},9536:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/Screenshot_from_2025-04-22_11-23-20-98bbd454f55f3aef4a60723251537015.png"},35227:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/Screenshot_from_2025-04-22_11-31-37-37dcf82a3474e593380b9a7b8b7820d3.png"},48212:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/Screenshot_from_2025-04-22_12-17-20-c5dc6aaa4481a103998864650373bc36.png"},28453:(e,i,n)=>{n.d(i,{R:()=>o,x:()=>l});var s=n(96540);const r={},t=s.createContext(r);function o(e){const i=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(t.Provider,{value:i},e.children)}}}]);