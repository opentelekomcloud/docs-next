"use strict";(self.webpackChunkdocs_next=self.webpackChunkdocs_next||[]).push([[18710],{60141:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>g,frontMatter:()=>t,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"blueprints/by-use-case/observability/migrate-from-promtail-to-grafana-alloy","title":"Migrating from Promtail to Grafana Alloy","description":"With Promtail reaching end-of-life on March 2, 2026, migrating to Grafana Alloy is essential for maintaining a supported and future-proof logging infrastructure. This blueprint guides you through converting your existing Promtail configuration to Alloy and deploying it on Cloud Container Engine (CCE). If you\'re currently running Promtail as described in Aggregate CCE Logs with Promtail & Grafana Loki, this guide provides a clear path forward.","source":"@site/docs/blueprints/by-use-case/observability/migrate-from-promtail-to-grafana-alloy.md","sourceDirName":"blueprints/by-use-case/observability","slug":"/blueprints/by-use-case/observability/migrate-from-promtail-to-grafana-alloy","permalink":"/docs-next/pr-preview/pr-366/docs/blueprints/by-use-case/observability/migrate-from-promtail-to-grafana-alloy","draft":false,"unlisted":false,"editUrl":"https://github.com/opentelekomcloud/docs-next/tree/main/docs/blueprints/by-use-case/observability/migrate-from-promtail-to-grafana-alloy.md","tags":[{"inline":true,"label":"cce","permalink":"/docs-next/pr-preview/pr-366/docs/tags/cce"},{"inline":true,"label":"observability","permalink":"/docs-next/pr-preview/pr-366/docs/tags/observability"},{"inline":true,"label":"logging","permalink":"/docs-next/pr-preview/pr-366/docs/tags/logging"},{"inline":true,"label":"grafana","permalink":"/docs-next/pr-preview/pr-366/docs/tags/grafana"},{"inline":true,"label":"loki","permalink":"/docs-next/pr-preview/pr-366/docs/tags/loki"},{"inline":true,"label":"alloy","permalink":"/docs-next/pr-preview/pr-366/docs/tags/alloy"},{"inline":true,"label":"promtail","permalink":"/docs-next/pr-preview/pr-366/docs/tags/promtail"},{"inline":true,"label":"migration","permalink":"/docs-next/pr-preview/pr-366/docs/tags/migration"}],"version":"current","sidebarPosition":5,"frontMatter":{"id":"migrate-from-promtail-to-grafana-alloy","title":"Migrating from Promtail to Grafana Alloy","tags":["cce","observability","logging","grafana","loki","alloy","promtail","migration"],"sidebar_position":5},"sidebar":"blueprintsSidebar","previous":{"title":"Aggregate CCE Logs with Grafana Alloy & Grafana Loki","permalink":"/docs-next/pr-preview/pr-366/docs/blueprints/by-use-case/observability/aggregate-cce-logs-with-grafana-alloy-and-grafana-loki"},"next":{"title":"Security","permalink":"/docs-next/pr-preview/pr-366/docs/blueprints/by-use-case/security/"}}');var r=i(74848),a=i(28453);const t={id:"migrate-from-promtail-to-grafana-alloy",title:"Migrating from Promtail to Grafana Alloy",tags:["cce","observability","logging","grafana","loki","alloy","promtail","migration"],sidebar_position:5},l="Migrating from Promtail to Grafana Alloy",s={},c=[{value:"Why Migrate to Grafana Alloy?",id:"why-migrate-to-grafana-alloy",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Migration Approaches",id:"migration-approaches",level:2},{value:"Convert Configuration (Recommended)",id:"convert-configuration-recommended",level:3},{value:"Run Promtail Configuration Natively",id:"run-promtail-configuration-natively",level:3},{value:"Converting Promtail Configuration to Alloy",id:"converting-promtail-configuration-to-alloy",level:2},{value:"Generating a Diagnostic Report",id:"generating-a-diagnostic-report",level:3},{value:"Handling Conversion Errors",id:"handling-conversion-errors",level:3},{value:"Configuration Differences to Consider",id:"configuration-differences-to-consider",level:3},{value:"Deploying Converted Configuration on CCE",id:"deploying-converted-configuration-on-cce",level:2},{value:"Creating the ConfigMap",id:"creating-the-configmap",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"migrating-from-promtail-to-grafana-alloy",children:"Migrating from Promtail to Grafana Alloy"})}),"\n",(0,r.jsxs)(n.p,{children:["With ",(0,r.jsx)(n.a,{href:"https://grafana.com/docs/loki/latest/send-data/promtail/",children:"Promtail reaching end-of-life on March 2, 2026"}),", migrating to Grafana Alloy is essential for maintaining a supported and future-proof logging infrastructure. This blueprint guides you through converting your existing Promtail configuration to Alloy and deploying it on Cloud Container Engine (CCE). If you're currently running Promtail as described in ",(0,r.jsx)(n.a,{href:"/docs/blueprints/by-use-case/observability/aggregate-cce-logs-with-promtail-and-grafana-loki",children:"Aggregate CCE Logs with Promtail & Grafana Loki"}),", this guide provides a clear path forward."]}),"\n",(0,r.jsx)(n.h2,{id:"why-migrate-to-grafana-alloy",children:"Why Migrate to Grafana Alloy?"}),"\n",(0,r.jsx)(n.p,{children:"Grafana Alloy replaces Promtail as the actively maintained log collection agent and offers significant advantages beyond simple log collection. As a unified telemetry collector, Alloy natively supports logs, metrics, traces, and profiles, allowing you to consolidate multiple specialized collectors into a single agent per node. Its component-based architecture provides flexibility to adapt to changing requirements, while enterprise-grade features like clustering, GitOps support, and advanced debugging capabilities ensure production readiness."}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(n.p,{children:"Before migrating, ensure you have the following:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["An existing Promtail configuration file (see ",(0,r.jsx)(n.a,{href:"/docs/blueprints/by-use-case/observability/aggregate-cce-logs-with-promtail-and-grafana-loki",children:"Aggregate CCE Logs with Promtail & Grafana Loki"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Grafana Alloy installed on your cluster (see ",(0,r.jsx)(n.a,{href:"/docs/blueprints/by-use-case/observability/aggregate-cce-logs-with-grafana-alloy-and-grafana-loki",children:"Aggregate CCE Logs with Grafana Alloy & Grafana Loki"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"migration-approaches",children:"Migration Approaches"}),"\n",(0,r.jsx)(n.p,{children:"Grafana Alloy supports two migration paths depending on your requirements and timeline:"}),"\n",(0,r.jsx)(n.h3,{id:"convert-configuration-recommended",children:"Convert Configuration (Recommended)"}),"\n",(0,r.jsxs)(n.p,{children:["Converting your Promtail configuration to Alloy's native format allows you to leverage all of Alloy's features and ensures long-term maintainability. The built-in ",(0,r.jsx)(n.code,{children:"convert"})," command automates most of the conversion process, translating YAML-based Promtail configurations into Alloy's component-based format."]}),"\n",(0,r.jsx)(n.h3,{id:"run-promtail-configuration-natively",children:"Run Promtail Configuration Natively"}),"\n",(0,r.jsxs)(n.p,{children:["For testing or temporary migration scenarios, Alloy can run Promtail configurations directly. This approach requires no configuration changes but doesn't provide access to Alloy's extended capabilities. This method is not discussed in this blueprint as it is intended for short-term use only. Visit ",(0,r.jsx)(n.a,{href:"https://grafana.com/docs/alloy/latest/set-up/migrate/from-promtail/#run-a-promtail-configuration",children:"Run a Promtail configuration"})," for more details."]}),"\n",(0,r.jsx)(n.h2,{id:"converting-promtail-configuration-to-alloy",children:"Converting Promtail Configuration to Alloy"}),"\n",(0,r.jsx)(n.p,{children:"The Alloy CLI provides a conversion tool that translates Promtail YAML configurations into Alloy's native format. To run the conversion:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Download the appropriate Alloy binary for your operating system from the ",(0,r.jsx)(n.a,{href:"https://github.com/grafana/alloy/releases",children:"Alloy GitHub releases page"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Extract the binary and make it executable:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"unzip alloy-linux-amd64.zip\nmv alloy-linux-amd64 alloy\nchmod +x ./alloy\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"Run the following command to convert your configuration:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./alloy convert --source-format=promtail --output=<OUTPUT_CONFIG_PATH> <INPUT_CONFIG_PATH>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Replace ",(0,r.jsx)(n.code,{children:"<INPUT_CONFIG_PATH>"})," with the full path to your Promtail configuration and ",(0,r.jsx)(n.code,{children:"<OUTPUT_CONFIG_PATH>"})," with the desired output path for the Alloy configuration."]}),"\n",(0,r.jsxs)(n.admonition,{title:"Extracting Promtail Configuration from Kubernetes",type:"tip",children:[(0,r.jsxs)(n.p,{children:["If you deployed Promtail using Helm (as described in ",(0,r.jsx)(n.a,{href:"/docs/blueprints/by-use-case/observability/aggregate-cce-logs-with-promtail-and-grafana-loki",children:"Aggregate CCE Logs with Promtail & Grafana Loki"}),"), your configuration is stored as a Kubernetes secret. Before running the conversion command, extract the current Promtail configuration from the cluster using the following command:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'kubectl get secret promtail -n monitoring -o jsonpath="{.data.promtail\\.yaml}" | base64 --decode > promtail-config.yaml\n'})}),(0,r.jsx)(n.p,{children:"Once extracted, use this file as input for the conversion process."})]}),"\n",(0,r.jsx)(n.admonition,{type:"important",children:(0,r.jsxs)(n.p,{children:["The Promtail Helm chart stores the configuration in a secret with the data key ",(0,r.jsx)(n.code,{children:"promtail.yaml"}),". If you customized your Helm installation with a different release name or namespace, adjust the secret name in the extraction command accordingly."]})}),"\n",(0,r.jsx)(n.h3,{id:"generating-a-diagnostic-report",children:"Generating a Diagnostic Report"}),"\n",(0,r.jsxs)(n.p,{children:["To understand conversion warnings and potential issues, generate a detailed report using the ",(0,r.jsx)(n.code,{children:"--report"})," flag:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./alloy convert --source-format=promtail --report=<OUTPUT_REPORT_PATH> --output=<OUTPUT_CONFIG_PATH> <INPUT_CONFIG_PATH>\n"})}),"\n",(0,r.jsx)(n.p,{children:"The diagnostic report highlights areas requiring manual attention, such as tracing configurations and metrics that differ between Promtail and Alloy."}),"\n",(0,r.jsx)(n.h3,{id:"handling-conversion-errors",children:"Handling Conversion Errors"}),"\n",(0,r.jsxs)(n.p,{children:["If the conversion encounters issues, diagnostic information is written to ",(0,r.jsx)(n.code,{children:"stderr"}),". For non-critical errors, you can force conversion using the ",(0,r.jsx)(n.code,{children:"--bypass-errors"})," flag:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./alloy convert --source-format=promtail --bypass-errors --output=<OUTPUT_CONFIG_PATH> <INPUT_CONFIG_PATH>\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"danger",children:(0,r.jsxs)(n.p,{children:["Using ",(0,r.jsx)(n.code,{children:"--bypass-errors"})," may result in behavioral differences between the original Promtail configuration and the converted Alloy configuration. Thoroughly test the converted configuration in a non-production environment before deploying to production."]})}),"\n",(0,r.jsx)(n.h3,{id:"configuration-differences-to-consider",children:"Configuration Differences to Consider"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Positions File Location:"})," Alloy stores the positions file at a different path than Promtail. If you have persistent volumes or specific paths configured for Promtail's positions file, update your storage configuration to use Alloy's default locations."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Metric Names:"})," Alloy exposes different metric names compared to Promtail. Update any dashboards, alerts, or monitoring queries that reference Promtail-specific metrics."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Service Discovery"})," For CCE deployments, ensure the converted ",(0,r.jsx)(n.code,{children:"discovery.kubernetes"})," component restricts discovery to pods on the same node as the Alloy pod. Update the configuration as follows:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'discovery.kubernetes "pods" {\n  role = "pod"\n  \n  selectors {\n    role = "pod"\n    field = "spec.nodeName=" + coalesce(sys.env("HOSTNAME"), constants.hostname)\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"deploying-converted-configuration-on-cce",children:"Deploying Converted Configuration on CCE"}),"\n",(0,r.jsxs)(n.p,{children:["Once you have a converted Alloy configuration, deploy it to your CCE cluster following the approach outlined in ",(0,r.jsx)(n.a,{href:"/docs/blueprints/by-use-case/observability/aggregate-cce-logs-with-grafana-alloy-and-grafana-loki",children:"Aggregate CCE Logs with Grafana Alloy & Grafana Loki"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Alternatively, update your existing Alloy configuration to reference the new converted configuration."}),"\n",(0,r.jsx)(n.h3,{id:"creating-the-configmap",children:"Creating the ConfigMap"}),"\n",(0,r.jsx)(n.p,{children:"Store your converted configuration in a ConfigMap:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: alloy-logs-config\n  namespace: monitoring\ndata:\n  config: |\n    # Paste your converted Alloy configuration here\n"})}),"\n",(0,r.jsx)(n.p,{children:"Apply the ConfigMap:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f alloy-configmap.yaml\n"})})]})}function g(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>l});var o=i(96540);const r={},a=o.createContext(r);function t(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);