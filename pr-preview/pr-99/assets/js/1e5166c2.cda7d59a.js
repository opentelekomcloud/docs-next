"use strict";(self.webpackChunkdocs_next=self.webpackChunkdocs_next||[]).push([[11276],{28711:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var s=i(74848),t=i(28453);const r={id:"auditing-and-analyzing-logins-and-logouts-with-functiongraph",title:"Auditing and Analyzing Logins and Logouts with Functiongraph",tags:["cts","cts-trigger","functiongraph","events","logs"]},a="Auditing and Analyzing Logins and Logouts with Functiongraph",o={id:"best-practices/management-and-deployment/cloud-trace/auditing-and-analyzing-logins-and-logouts-with-functiongraph",title:"Auditing and Analyzing Logins and Logouts with Functiongraph",description:"Cloud Trace Service (CTS) collects real-time records of operations on cloud resources. You can create a CTS trigger to obtain records of subscribed cloud resource operations, analyze and process the operation records, and report alarms. You can use Simple Message Notification (SMN) to push alarm messages to service personnel by SMS message or email. Figure 1 shows the procedure.",source:"@site/docs/best-practices/management-and-deployment/cloud-trace/auditing-and-analyzing-logins-and-logouts-with-functiongraph.md",sourceDirName:"best-practices/management-and-deployment/cloud-trace",slug:"/best-practices/management-and-deployment/cloud-trace/auditing-and-analyzing-logins-and-logouts-with-functiongraph",permalink:"/docs-next/pr-preview/pr-99/docs/best-practices/management-and-deployment/cloud-trace/auditing-and-analyzing-logins-and-logouts-with-functiongraph",draft:!1,unlisted:!1,editUrl:"https://github.com/akyriako/docs-next/tree/main/docs/best-practices/management-and-deployment/cloud-trace/auditing-and-analyzing-logins-and-logouts-with-functiongraph.md",tags:[{inline:!0,label:"cts",permalink:"/docs-next/pr-preview/pr-99/docs/tags/cts"},{inline:!0,label:"cts-trigger",permalink:"/docs-next/pr-preview/pr-99/docs/tags/cts-trigger"},{inline:!0,label:"functiongraph",permalink:"/docs-next/pr-preview/pr-99/docs/tags/functiongraph"},{inline:!0,label:"events",permalink:"/docs-next/pr-preview/pr-99/docs/tags/events"},{inline:!0,label:"logs",permalink:"/docs-next/pr-preview/pr-99/docs/tags/logs"}],version:"current",frontMatter:{id:"auditing-and-analyzing-logins-and-logouts-with-functiongraph",title:"Auditing and Analyzing Logins and Logouts with Functiongraph",tags:["cts","cts-trigger","functiongraph","events","logs"]},sidebar:"bestPracticesSidebar",previous:{title:"Resource Group Monitoring",permalink:"/docs-next/pr-preview/pr-99/docs/best-practices/management-and-deployment/cloud-eye/resource-group-monitoring"},next:{title:"Configuring Private Domain Names for ECSs",permalink:"/docs-next/pr-preview/pr-99/docs/best-practices/networking/domain-name-service/configuring-private-domain-names-for-ecss"}},c={},l=[{value:"Solution Design",id:"solution-design",level:2},{value:"Enabling CTS",id:"enabling-cts",level:2},{value:"Creating an Agency",id:"creating-an-agency",level:2},{value:"Pushing Alarm Messages",id:"pushing-alarm-messages",level:2},{value:"Building a Program",id:"building-a-program",level:2},{value:"Creating a Function",id:"creating-a-function",level:3},{value:"Setting Environment Variables",id:"setting-environment-variables",level:3},{value:"Adding an Event Source",id:"adding-an-event-source",level:2},{value:"Processing Operation Records",id:"processing-operation-records",level:2}];function d(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"auditing-and-analyzing-logins-and-logouts-with-functiongraph",children:"Auditing and Analyzing Logins and Logouts with Functiongraph"}),"\n",(0,s.jsxs)(n.p,{children:["Cloud Trace Service (CTS) collects real-time records of operations on cloud resources. You can create a CTS trigger to obtain records of subscribed cloud resource operations, analyze and process the operation records, and report alarms. You can use Simple Message Notification (SMN) to push alarm messages to service personnel by SMS message or email. ",(0,s.jsx)(n.a,{href:"#figure-1",children:"Figure 1"})," shows the procedure."]}),"\n",(0,s.jsx)(n.h2,{id:"solution-design",children:"Solution Design"}),"\n",(0,s.jsx)("a",{id:"figure-1"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Figure 1",src:i(60435).A+"",width:"753",height:"460"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Figure 1"})," Flowchart"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Operation records collected by CTS can be quickly analyzed and operations from specified IP addresses can be filtered out."}),"\n",(0,s.jsx)(n.li,{children:"CTS processes and analyzes data in response to log events in a serverless architecture, which features automatic scaling, no O&M, and pay-per-use billing."}),"\n",(0,s.jsx)(n.li,{children:"CTS sends alarm notifications through SMN."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"enabling-cts",children:"Enabling CTS"}),"\n",(0,s.jsx)(n.p,{children:"Configure a tracker, and the system immediately starts recording operations based on the new rule."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Log in to the console."}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.img,{src:i(55435).A+"",width:"15",height:"18"})," in the upper left corner of the console and select a region and a project."]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.img,{src:i(72312).A+"",width:"25",height:"23"})," in the upper left corner and choose ",(0,s.jsx)(n.em,{children:"Management & Governance"})," -> ",(0,s.jsx)(n.em,{children:"Cloud Trace Service"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["On the displayed page, choose ",(0,s.jsx)(n.em,{children:"Tracker List"})," in the navigation pane on the left."]}),"\n",(0,s.jsxs)(n.li,{children:["Locate a data tracker and click ",(0,s.jsx)(n.em,{children:"Configure"})," in the ",(0,s.jsx)(n.em,{children:"Operation"})," column.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Operation"}),": Select the data operations that need to be recorded."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Transfer to OBS"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["If you select ",(0,s.jsx)(n.em,{children:"Yes"}),", select an existing OBS bucket or create one directly on the ",(0,s.jsx)(n.em,{children:"Configure Tracker"})," page and set ",(0,s.jsx)(n.strong,{children:"File Prefix"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["If you select ",(0,s.jsx)(n.em,{children:"No"}),", no configuration is required."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Create OBS Bucket"}),": If this function is enabled, an OBS bucket will be created automatically with the name you enter. If this function is disabled, select an existing OBS bucket."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"OBS Bucket"}),": You can create an OBS bucket or select an existing OBS bucket."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Retention Period"}),": Select the duration for storing traces in the OBS bucket."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"File Prefix"}),": The prefix is used to mark a transferred trace file. Your specified prefix will be automatically added to the beginning of the name of a transferred file, helping you quickly filter files."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Verify Trace File"}),": When this function is enabled, integrity verification will be performed to check whether trace files in OBS buckets have been tampered with."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.em,{children:"OK"})," to complete the tracker configuration."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"creating-an-agency",children:"Creating an Agency"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Log in to the ",(0,s.jsx)(n.a,{href:"https://console.otc.t-systems.com/iam/?locale=en-us",children:(0,s.jsx)(n.em,{children:"Identity and Access Management (IAM) console"})}),". In the navigation pane on the left, choose ",(0,s.jsx)(n.em,{children:"Agencies"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["On the ",(0,s.jsx)(n.em,{children:"Agencies"})," page, click ",(0,s.jsx)(n.em,{children:"Create Agency"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Set the agency information."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For ",(0,s.jsx)(n.strong,{children:"Agency Name"}),", enter ",(0,s.jsx)(n.code,{children:"serverless\\_trust"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["For ",(0,s.jsx)(n.strong,{children:"Agency Type"}),", select ",(0,s.jsx)(n.strong,{children:"Cloud service"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["For ",(0,s.jsx)(n.strong,{children:"Cloud service"}),", select ",(0,s.jsx)(n.strong,{children:"FunctionGraph"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["For ",(0,s.jsx)(n.strong,{children:"Validity Period"}),", select ",(0,s.jsx)(n.strong,{children:"Unlimited"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.em,{children:"Assign Permissions"}),". On the ",(0,s.jsx)(n.em,{children:"Assign Permissions"})," page, select ",(0,s.jsx)(n.strong,{children:"Tenant Administrator"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["Users with the ",(0,s.jsx)(n.strong,{children:"Tenant Administrator"})," permission can perform any operations on all cloud resources of the enterprise."]})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Click ",(0,s.jsx)(n.em,{children:"OK"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"pushing-alarm-messages",children:"Pushing Alarm Messages"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Create a topic named ",(0,s.jsx)(n.code,{children:"cts\\_test"})," on the ",(0,s.jsx)(n.em,{children:"SMN console"}),". For details, see ",(0,s.jsx)(n.a,{href:"https://docs.otc.t-systems.com/simple-message-notification/umn/topic_management/creating_a_topic.html",children:"Creating a Topic"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Add subscriptions to the ",(0,s.jsx)(n.strong,{children:"cts_test"})," topic to push alarm messages. For details, see ",(0,s.jsx)(n.a,{href:"https://docs.otc.t-systems.com/simple-message-notification/umn/topic_management/adding_a_subscription_to_a_topic.html",children:"Adding a Subscription"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Alarm messages can be sent by ",(0,s.jsx)(n.strong,{children:"emails"}),", ",(0,s.jsx)(n.strong,{children:"SMS"})," messages, and ",(0,s.jsx)(n.strong,{children:"HTTP/HTTPS"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"In this example, when log events trigger the specified function, the function filters operations that are performed by users not in the IP address whitelist, and pushes alarm messages to the subscribers."}),"\n"]})}),"\n",(0,s.jsx)(n.h2,{id:"building-a-program",children:"Building a Program"}),"\n",(0,s.jsxs)(n.p,{children:["This section describes how to download and use the program package ",(0,s.jsx)(n.a,{href:"https://functionstage-examples.obs.cn-north-1.myhuaweicloud.com/index.zip",children:"(index.zip)"})," for log alarms."]}),"\n",(0,s.jsx)(n.h3,{id:"creating-a-function",children:"Creating a Function"}),"\n",(0,s.jsxs)(n.p,{children:["Create a function for extracting logs and upload the ",(0,s.jsx)(n.a,{href:"https://functionstage-examples.obs.cn-north-1.myhuaweicloud.com/fss_examples_logstore_warning.zip",children:"sample code"})," package. For details, see ",(0,s.jsx)(n.a,{href:"https://docs.otc.t-systems.com/function-graph/umn/function_management.html",children:"Function Management"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"This function analyzes received operation records, filters logins or logouts from unauthorized IP addresses using a whitelist, and sends alarms under a specified SMN topic."}),"\n",(0,s.jsx)(n.h3,{id:"setting-environment-variables",children:"Setting Environment Variables"}),"\n",(0,s.jsxs)(n.p,{children:["On the ",(0,s.jsx)(n.em,{children:"Configuration"})," tab page of the function, set the environment variables and SMN topic name, as shown in table below:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Environment Variable"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"SMN_Topic"}),(0,s.jsx)(n.td,{children:"SMN topic name."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"RegionName"}),(0,s.jsx)(n.td,{children:"Region."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"IP"}),(0,s.jsx)(n.td,{children:"IP address whitelist."})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Table 1"})," Environment variable description"]}),"\n",(0,s.jsxs)(n.p,{children:["For details about how to set environment variables, see ",(0,s.jsx)(n.a,{href:"https://docs.otc.t-systems.com/function-graph/umn/configuring_functions/configuring_environment_variables.html",children:"Using Environment Variables"}),", as shown in ",(0,s.jsx)(n.a,{href:"#figure-2",children:"Figure 2"}),"."]}),"\n",(0,s.jsx)("a",{id:"figure-2"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(69273).A+"",width:"859",height:"307"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Figure 2"})," Setting environment variables"]}),"\n",(0,s.jsx)(n.h2,{id:"adding-an-event-source",children:"Adding an Event Source"}),"\n",(0,s.jsxs)(n.p,{children:["Create a CTS trigger, as shown in ",(0,s.jsx)(n.a,{href:"#enabling-cts",children:"Enabling CTS"}),". For details, see ",(0,s.jsx)(n.a,{href:"https://docs.otc.t-systems.com/function-graph/umn/creating_triggers/using_a_cts_trigger.html",children:"Using a CTS Trigger"}),"."]}),"\n",(0,s.jsx)("a",{id:"figure-3"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(38949).A+"",width:"671",height:"560"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Figure 3"})," Creating a CTS trigger"]}),"\n",(0,s.jsx)(n.p,{children:"CTS records the logins and logouts of users on IAM."}),"\n",(0,s.jsx)(n.h2,{id:"processing-operation-records",children:"Processing Operation Records"}),"\n",(0,s.jsxs)(n.p,{children:["When a user performs login or logout using an account, the subscription service log will be triggered and a function will be directly invoked. The system then checks whether the IP address of the current login or logout account is in the whitelist based on function code. If the IP address is not in the whitelist, SMN will send notifications, as shown in ",(0,s.jsx)(n.a,{href:"#figure-4",children:"Figure 4"}),"."]}),"\n",(0,s.jsx)("a",{id:"figure-4"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://support.huaweicloud.com/intl/en-us/bestpractice-cts/en-us_image_0000001312598869.png",alt:""})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Figure 4"})," Alarm notification sent by email"]}),"\n",(0,s.jsx)(n.p,{children:"The email contains the unauthorized IP address and user operation (login or logout)."}),"\n",(0,s.jsxs)(n.p,{children:["On the ",(0,s.jsx)(n.em,{children:"Monitoring"})," tab page of the function, check the number of invocations, as shown in ",(0,s.jsx)(n.a,{href:"#figure-5",children:"Figure 5"}),"."]}),"\n",(0,s.jsx)("a",{id:"figure-"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Figure 5"})," Function metrics",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.img,{src:"https://support.huaweicloud.com/intl/en-us/bestpractice-cts/en-us_image_0000001312357985.png",alt:""})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},69273:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/en-us_image_0000001264392960-9054719e1a3dce557972321447efaadb.png"},60435:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/en-us_image_0000001264679162-167335dc9b9138298f172342e243483d.png"},38949:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/en-us_image_0000001312436037-e3255c9a57e3bf03e77905d1bad381f0.png"},55435:(e,n,i)=>{i.d(n,{A:()=>s});const s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAASCAYAAACEnoQPAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAGkSURBVDiNndO/i+JAGMfhj8eQLFYagkUKbSyEYCysRLCwsFJEwc7av8tCEGJnIfaaSkWxEWzFFCIqGAKJgbviUC5m2Vv2W87MMzPv/Ih5nvebH+bXT+F/8e12+xKL94bdbodlWTiO82pLJpM0m00SiURobOzfmufzOcvlEgBZllEUhcvlgud5ALRaLTKZTBTbto1pmgghaDQaoUGr1YrZbIYQgl6vhyRJ4ZoXiwUAlUrlBZ81F4tFdF0nCALW6/Vr0he+3W4IIcjlcgAMBgP6/T6TyQSAQqEAwPF4jOJnJEnC933u9zsAl8sl1P94PKL44+ODIAiwbRtJkmg2mxiGQbvdBuBwOACgKEoUZ7NZADabDQCaplGtVonH48DfKwTQdT2K8/k8siyz3+85nU6hrW63W87nM6qqomlaFEuSRLlcBmA8HuP7PgCu62JZFgC1Wi00aejADMMgnU7jOA6maeL7PqPRCM/zKJVKpFKpEI69/yrf9xkOh1yvV4QQBEGAqqp0u13e8+lVdTodZFn+En668jOu6zKdTqnX66/n+G38nfwBKbqv10VnRowAAAAASUVORK5CYII="},72312:(e,n,i)=>{i.d(n,{A:()=>s});const s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAXCAYAAAD+4+QTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAABSSURBVEiJY/z///9/BhoDJlpbQDdLWGCM9+8/MKRllTJcvHyNIgP1dbUYZk3rZhAUFICL0cUnjKMRPzItGU3CJIHhE/HDx5LRJEwSGD4RTxdLANA6KyHkPZlqAAAAAElFTkSuQmCC"},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var s=i(96540);const t={},r=s.createContext(t);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);